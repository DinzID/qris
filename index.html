<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeShare - DinzSC</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Highlight.js untuk syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/vs2015.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #FF7B00;
            --secondary-color: #FFAA33;
            --accent-color: #FF5500;
            --dark-bg: #1A1A2E;
            --dark-card: #252947;
            --dark-text: #FFFFFF;
            --light-bg: #F0F0F0;
            --light-card: #FFFFFF;
            --light-text: #333333;
            --skin-color: #FFD6B8;
            --comic-border: #FF7B00;
            --error-color: #FF3333;
            --success-color: #333333;
            --warning-color: #FFAA00;
            --info-color: #3399FF;
            --verified-color: #1DA1F2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s ease;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--dark-text);
            min-height: 100vh;
            padding-bottom: 80px;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255, 123, 0, 0.1) 2px, transparent 2px),
                radial-gradient(circle at 75% 75%, rgba(255, 170, 51, 0.1) 2px, transparent 2px);
            background-size: 30px 30px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Styles */
        header {
            background-color: var(--dark-card);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid var(--comic-border);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.2);
        }

        .logo i {
            font-size: 2rem;
        }

        .nav-desktop {
            display: none;
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        /* Button Styles */
        button {
            cursor: pointer;
            border: none;
            border-radius: 8px;
            padding: 12px 18px;
            font-weight: 500;
            transition: all 0.3s;
            font-family: 'Roboto', sans-serif;
            position: relative;
            overflow: hidden;
        }

        button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 4px 0 rgba(179, 85, 0, 0.8);
        }

        .btn-primary:hover {
            background-color: #FF6A00;
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(179, 85, 0, 0.8);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
            box-shadow: 0 4px 0 rgba(179, 119, 0, 0.8);
        }

        .btn-secondary:hover {
            background-color: #FF9900;
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(179, 119, 0, 0.8);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            box-shadow: 0 4px 0 rgba(255, 123, 0, 0.3);
        }

        .btn-outline:hover {
            background-color: rgba(255, 123, 0, 0.1);
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(255, 123, 0, 0.3);
        }

        .btn-danger {
            background-color: var(--error-color);
            color: white;
            box-shadow: 0 4px 0 rgba(179, 0, 0, 0.8);
        }

        .btn-danger:hover {
            background-color: #FF1111;
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(179, 0, 0, 0.8);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary-color);
        }

        input, textarea, select {
            width: 100%;
            padding: 14px;
            border-radius: 8px;
            border: 2px solid var(--dark-card);
            background-color: var(--dark-card);
            color: var(--dark-text);
            font-family: 'Roboto', sans-serif;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 123, 0, 0.3);
        }

        /* Card Styles */
        .card {
            background-color: var(--dark-card);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            border: 2px solid var(--comic-border);
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 1px solid rgba(255, 123, 0, 0.3);
            border-radius: 8px;
            pointer-events: none;
        }

        /* Page Styles */
        .page {
            display: none;
            padding: 24px 0;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page.active {
            display: block;
        }

        /* Auth Page */
        .auth-container {
            max-width: 400px;
            margin: 40px auto;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 24px;
            border-bottom: 2px solid var(--dark-card);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 16px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: var(--dark-text);
        }

        .auth-tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
        }

        .auth-providers {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 24px;
        }

        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 24px 0;
            color: var(--secondary-color);
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 2px solid var(--dark-card);
        }

        .divider span {
            padding: 0 12px;
        }

        /* Home Page */
        .share-button-container {
            text-align: center;
            margin: 24px 0;
        }

        .code-feed {
            margin-top: 24px;
        }

        .code-card {
            margin-bottom: 24px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .code-card:hover {
            transform: translateY(-5px);
        }

        .code-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
            border: 2px solid var(--primary-color);
        }

        .user-info {
            flex: 1;
        }

        .username {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--dark-text);
        }

        .verified-badge {
            color: var(--verified-color);
            font-size: 0.9rem;
        }

        .code-language {
            background-color: var(--primary-color);
            color: white;
            padding: 4px 10px;
            border-radius: 14px;
            font-size: 0.8rem;
            display: inline-block;
            margin-top: 4px;
        }

        .code-preview {
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 16px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--comic-border);
        }

        .code-preview pre {
            margin: 0;
            overflow: hidden;
            max-height: 150px;
            mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
        }

        .code-stats {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            color: var(--secondary-color);
            font-size: 0.9rem;
        }

        .code-stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Share Code Page */
        .code-editor-container {
            margin-bottom: 24px;
        }

        .code-editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        #code-editor {
            width: 100%;
            min-height: 300px;
            font-family: 'Courier New', monospace;
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: 8px;
            resize: vertical;
            border: 2px solid var(--comic-border);
        }

        .code-preview-container {
            margin-top: 24px;
        }

        /* View Code Page */
        .view-code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .code-container {
            position: relative;
            border: 2px solid var(--comic-border);
            border-radius: 8px;
            overflow: hidden;
        }

        .code-actions {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .copy-button {
            background-color: rgba(30, 30, 30, 0.8);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 14px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Profile Page */
        .profile-header {
            position: relative;
            margin-bottom: 70px;
        }

        .profile-banner {
            height: 180px;
            background-color: var(--primary-color);
            border-radius: 12px 12px 0 0;
            position: relative;
            background-size: cover;
            background-position: center;
            border: 2px solid var(--comic-border);
            border-bottom: none;
        }

        .profile-avatar-container {
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--dark-card);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            background-color: var(--dark-card);
        }

        .profile-content {
            padding: 0 20px 20px;
            text-align: center;
        }

        .profile-info {
            margin-top: 60px;
        }

        .profile-name {
            font-size: 1.6rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .profile-bio {
            margin: 16px 0;
            color: var(--secondary-color);
            font-style: italic;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }

        .profile-stats {
            display: flex;
            gap: 24px;
            justify-content: center;
            margin: 20px 0;
        }

        .profile-stat {
            text-align: center;
            padding: 16px;
            background-color: rgba(255, 123, 0, 0.1);
            border-radius: 12px;
            min-width: 120px;
            border: 1px solid var(--comic-border);
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--secondary-color);
            margin-top: 4px;
        }

        .profile-codes {
            margin-top: 32px;
        }

        /* Edit Profile Page */
        .image-upload-container {
            margin-bottom: 24px;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-top: 12px;
            border: 2px solid var(--comic-border);
        }

        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-top: 12px;
            border: 2px solid var(--comic-border);
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .upload-progress {
            margin-top: 12px;
            background-color: var(--dark-bg);
            border-radius: 8px;
            height: 20px;
            overflow: hidden;
            display: none;
            border: 1px solid var(--comic-border);
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s;
        }

        /* Upload Button Styles */
        .upload-btn-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            margin-top: 10px;
            width: 100%;
        }

        .upload-btn-wrapper .btn-outline {
            width: 100%;
            text-align: center;
        }

        .upload-btn-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        /* GitHub Config Section */
        .github-config {
            background-color: rgba(0, 0, 0, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9rem;
            display: none;
        }

        .github-config h4 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .github-config p {
            margin-bottom: 8px;
            color: var(--secondary-color);
        }

        /* Leaderboard Page */
        .leaderboard-list {
            margin-top: 24px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 2px solid var(--dark-bg);
            transition: background-color 0.3s;
        }

        .leaderboard-item:hover {
            background-color: rgba(255, 123, 0, 0.05);
        }

        .leaderboard-rank {
            font-size: 1.3rem;
            font-weight: bold;
            width: 50px;
            text-align: center;
            color: var(--primary-color);
        }

        .leaderboard-user {
            display: flex;
            align-items: center;
            flex: 1;
            gap: 12px;
        }

        .leaderboard-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
        }

        .leaderboard-value {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--dark-card);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            border-top: 2px solid var(--comic-border);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--secondary-color);
            text-decoration: none;
            font-size: 0.8rem;
            padding: 8px;
            border-radius: 12px;
            transition: all 0.3s;
        }

        .nav-item.active {
            color: var(--primary-color);
            background-color: rgba(255, 123, 0, 0.1);
        }

        .nav-item i {
            font-size: 1.4rem;
            margin-bottom: 4px;
        }

        /* Notifications */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .notification {
            background-color: var(--dark-card);
            color: var(--dark-text);
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s forwards, fadeOut 0.5s forwards 2.5s;
            max-width: 350px;
            border-left: 4px solid var(--info-color);
        }

        .notification.success {
            border-left-color: var(--success-color);
        }

        .notification.error {
            border-left-color: var(--error-color);
        }

        .notification.warning {
            border-left-color: var(--warning-color);
        }

        .notification.info {
            border-left-color: var(--info-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        /* Loading Spinner */
        .spinner {
            width: 28px;
            height: 28px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            display: inline-block;
            margin: 20px auto;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Admin Badge */
        .admin-badge {
            background-color: var(--verified-color);
            color: white;
            padding: 3px 10px;
            border-radius: 14px;
            font-size: 0.7rem;
            margin-left: 6px;
        }

        .verified-badge {
            background-color: var(--verified-color);
            color: white;
            padding: 3px 8px;
            border-radius: 14px;
            font-size: 0.7rem;
            margin-left: 6px;
        }

        /* Search Page */
        .search-container {
            margin-bottom: 24px;
        }

        .search-results {
            margin-top: 24px;
        }

        /* Admin Page */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .admin-stat-card {
            background-color: var(--dark-card);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid var(--comic-border);
        }

        .admin-stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .admin-stat-label {
            color: var(--secondary-color);
            font-size: 0.9rem;
        }

        /* Pagination Styles */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 10px;
        }

        .pagination-btn {
            padding: 8px 16px;
            border-radius: 8px;
            background-color: var(--dark-card);
            color: var(--dark-text);
            border: 1px solid var(--comic-border);
            cursor: pointer;
        }

        .pagination-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .pagination-btn:hover:not(.active) {
            background-color: rgba(255, 123, 0, 0.2);
        }

        /* Share Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
        }

        .modal {
            background-color: var(--dark-card);
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--comic-border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--dark-text);
            font-size: 24px;
            cursor: pointer;
        }

        .share-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .share-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            background-color: rgba(255, 123, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s;
        }

        .share-option:hover {
            background-color: rgba(255, 123, 0, 0.2);
            transform: translateY(-3px);
        }

        .share-option i {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .share-link {
            display: flex;
            align-items: center;
            margin-top: 20px;
            background-color: var(--dark-bg);
            padding: 10px;
            border-radius: 8px;
        }

        .share-link input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--dark-text);
        }

        .copy-link-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
        }

        /* Social Media Links */
        .social-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
        }

        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 123, 0, 0.1);
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }

        .social-link:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-3px);
        }

        /* Follow Button */
        .follow-btn {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .follow-btn.following {
            background-color: var(--success-color);
        }

        /* Responsive Styles */
        @media (min-width: 768px) {
            .nav-desktop {
                display: flex;
                gap: 24px;
            }
            
            .nav-item-desktop {
                color: var(--dark-text);
                text-decoration: none;
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 8px 16px;
                border-radius: 8px;
                transition: background-color 0.3s;
            }
            
            .nav-item-desktop:hover {
                background-color: rgba(255, 123, 0, 0.1);
            }
            
            .nav-item-desktop.active {
                color: var(--primary-color);
                background-color: rgba(255, 123, 0, 0.1);
            }
            
            .bottom-nav {
                display: none;
            }
            
            body {
                padding-bottom: 0;
            }

            .profile-stats {
                gap: 30px;
            }

            .profile-stat {
                min-width: 140px;
            }
        }

        /* Pixel art elements */
        .pixel-divider {
            height: 4px;
            background-image: 
                linear-gradient(90deg, 
                    transparent 0%, 
                    var(--primary-color) 20%, 
                    var(--secondary-color) 40%, 
                    var(--primary-color) 60%, 
                    var(--secondary-color) 80%, 
                    transparent 100%);
            margin: 20px 0;
            image-rendering: pixelated;
        }

        .comic-button {
            position: relative;
            border: 2px solid #000;
            box-shadow: 4px 4px 0 #000;
            transition: all 0.1s ease;
        }

        .comic-button:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
        }
        
        .page-info {
            padding: 8px 16px;
            margin: 0 10px;
            background-color: var(--dark-card);
            border-radius: 8px;
            color: var(--dark-text);
            border: 1px solid var(--comic-border);
        }

        /* Delete Button */
        .delete-btn {
            background-color: var(--error-color);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        /* Follow Stats */
        .follow-stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 15px 0;
        }

        .follow-stat {
            text-align: center;
            cursor: pointer;
        }

        .follow-stat:hover {
            color: var(--primary-color);
        }

        .follow-stat-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .follow-stat-label {
            font-size: 0.8rem;
            color: var(--secondary-color);
        }
        
        /* Clickable username */
        .clickable-username {
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .clickable-username:hover {
            color: var(--primary-color);
        }
        
        /* AI Chat Styles */
.ai-chat-container {
    margin-top: 20px;
    border: 2px solid var(--comic-border);
    border-radius: 12px;
    padding: 20px;
    background-color: var(--dark-card);
}

.ai-welcome-message {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    margin-bottom: 20px;
    padding: 15px;
    background-color: rgba(255, 123, 0, 0.1);
    border-radius: 12px;
    border-left: 4px solid var(--primary-color);
}

.ai-avatar img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 2px solid var(--primary-color);
    object-fit: cover;
}

.ai-message h3 {
    color: var(--primary-color);
    margin-bottom: 8px;
}

.ai-chat-messages {
    max-height: 400px;
    overflow-y: auto;
    margin-bottom: 20px;
    padding: 10px;
    background-color: rgba(30, 30, 30, 0.5);
    border-radius: 8px;
    border: 1px solid var(--comic-border);
}

.ai-message-bubble {
    padding: 12px 16px;
    margin: 10px 0;
    border-radius: 12px;
    max-width: 80%;
    position: relative;
}

.ai-user-message {
    background-color: var(--primary-color);
    color: white;
    margin-left: auto;
    border-bottom-right-radius: 4px;
}

.ai-bot-message {
    background-color: var(--dark-bg);
    color: var(--dark-text);
    margin-right: auto;
    border-bottom-left-radius: 4px;
    border: 1px solid var(--comic-border);
}

.ai-message-time {
    font-size: 0.7rem;
    opacity: 0.7;
    margin-top: 5px;
    text-align: right;
}

.ai-chat-input-container {
    margin-top: 20px;
}

.ai-input-area {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

#ai-user-input {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    border: 2px solid var(--dark-card);
    background-color: var(--dark-bg);
    color: var(--dark-text);
    resize: vertical;
    font-family: 'Courier New', monospace;
}

#ai-user-input:focus {
    outline: none;
    border-color: var(--primary-color);
}

.ai-options {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
}

.ai-option-btn {
    font-size: 0.8rem;
    padding: 8px 12px;
}

.ai-typing-indicator {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 10px;
    color: var(--secondary-color);
    font-style: italic;
}

.ai-typing-dot {
    width: 6px;
    height: 6px;
    background-color: var(--secondary-color);
    border-radius: 50%;
    animation: aiTyping 1.4s infinite ease-in-out;
}

.ai-typing-dot:nth-child(2) {
    animation-delay: 0.2s;
}

.ai-typing-dot:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes aiTyping {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-3px); }
}

/* Responsive styles */
@media (max-width: 768px) {
    .ai-options {
        flex-direction: column;
    }
    
    .ai-option-btn {
        width: 100%;
    }
    
    .ai-input-area {
        flex-direction: column;
    }
    
    .ai-message-bubble {
        max-width: 90%;
    }
}

/* AI Chat Navigation Styles */
#ai-chat-nav-mobile {
    display: flex !important; /* Force show on mobile */
}

/* Untuk desktop, tombol AI harus tetap muncul */
.nav-item-desktop[data-page="ai-chat"] {
    display: flex;
    align-items: center;
    gap: 6px;
}

/* Pastikan bottom nav item untuk AI visible */
.bottom-nav .nav-item[data-page="ai-chat"] {
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .nav-desktop [data-page="ai-chat"] {
        display: none !important; /* Sembunyikan di desktop view pada mobile */
    }
    
    .bottom-nav .nav-item[data-page="ai-chat"] {
        display: flex !important; /* Pastikan muncul di mobile */
    }
}

@media (min-width: 769px) {
    .bottom-nav .nav-item[data-page="ai-chat"] {
        display: none !important; /* Sembunyikan di mobile view pada desktop */
    }
    
    .nav-desktop [data-page="ai-chat"] {
        display: flex !important; /* Pastikan muncul di desktop */
    }
}

/* AI Chat Full Screen Styles */
.ai-chat-fullscreen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--dark-bg);
    display: flex;
    flex-direction: column;
    z-index: 1000;
    animation: aiSlideIn 0.3s ease-out;
}

@keyframes aiSlideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* AI Chat Header */
.ai-chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: var(--dark-card);
    border-bottom: 2px solid var(--comic-border);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.ai-chat-title {
    display: flex;
    align-items: center;
    gap: 15px;
}

.ai-avatar {
    position: relative;
    width: 50px;
    height: 50px;
}

.ai-avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 2px solid var(--primary-color);
    object-fit: cover;
}

.ai-status {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 12px;
    height: 12px;
    background: #4CAF50;
    border: 2px solid var(--dark-card);
    border-radius: 50%;
}

.ai-title-content h2 {
    color: var(--primary-color);
    font-size: 1.3rem;
    margin-bottom: 2px;
}

.ai-title-content p {
    color: var(--secondary-color);
    font-size: 0.9rem;
    margin: 0;
}

.ai-chat-controls {
    display: flex;
    gap: 10px;
}

.ai-control-btn {
    background: rgba(255, 123, 0, 0.1);
    border: 1px solid var(--primary-color);
    color: var(--primary-color);
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
}

.ai-control-btn:hover {
    background: var(--primary-color);
    color: white;
}

/* AI Chat Main Content */
.ai-chat-main {
    display: flex;
    flex: 1;
    overflow: hidden;
}

/* AI Sidebar */
.ai-sidebar {
    width: 280px;
    background: var(--dark-card);
    border-right: 2px solid var(--comic-border);
    padding: 20px;
    overflow-y: auto;
}

.ai-sidebar-section {
    margin-bottom: 25px;
}

.ai-sidebar-section h3 {
    color: var(--primary-color);
    font-size: 0.9rem;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* AI Model List */
.ai-model-list,
.ai-mode-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.ai-model-item,
.ai-mode-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    border: 1px solid transparent;
}

.ai-model-item:hover,
.ai-mode-item:hover {
    background: rgba(255, 123, 0, 0.1);
    border-color: var(--primary-color);
}

.ai-model-item.active,
.ai-mode-item.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--accent-color);
}

.ai-model-item i,
.ai-mode-item i {
    width: 20px;
    text-align: center;
    font-size: 1.1rem;
}

/* Quick Actions */
.ai-quick-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.ai-quick-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    padding: 12px 8px;
    background: rgba(255, 123, 0, 0.05);
    border: 1px solid var(--comic-border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
}

.ai-quick-btn:hover {
    background: rgba(255, 123, 0, 0.1);
    transform: translateY(-2px);
}

.ai-quick-btn i {
    font-size: 1.2rem;
    color: var(--primary-color);
}

.ai-quick-btn span {
    font-size: 0.8rem;
    color: var(--dark-text);
}

/* AI Chat Content */
.ai-chat-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--dark-bg);
}

.ai-chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* AI Message Bubbles */
.ai-message-bubble {
    max-width: 70%;
    animation: messagePopIn 0.3s ease-out;
}

@keyframes messagePopIn {
    from {
        opacity: 0;
        transform: translateY(10px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.ai-user-message {
    align-self: flex-end;
}

.ai-bot-message {
    align-self: flex-start;
}

.ai-message-content {
    background: var(--dark-card);
    border-radius: 18px;
    padding: 16px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    border: 1px solid var(--comic-border);
}

.ai-user-message .ai-message-content {
    background: var(--primary-color);
    color: white;
}

.ai-message-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 0.8rem;
}

.ai-sender {
    font-weight: 600;
    color: var(--primary-color);
}

.ai-user-message .ai-sender {
    color: white;
}

.ai-time {
    color: var(--secondary-color);
    font-size: 0.7rem;
}

.ai-message-text {
    line-height: 1.5;
}

.ai-message-text h3 {
    margin-bottom: 10px;
    color: inherit;
}

.ai-message-text ul {
    margin: 10px 0;
    padding-left: 20px;
}

.ai-message-text li {
    margin-bottom: 5px;
}

/* AI Chat Input */
.ai-chat-input-container {
    padding: 20px;
    background: var(--dark-card);
    border-top: 2px solid var(--comic-border);
}

.ai-input-tools {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.ai-tool-btn {
    background: rgba(255, 123, 0, 0.1);
    border: 1px solid var(--comic-border);
    color: var(--primary-color);
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
}

.ai-tool-btn:hover {
    background: var(--primary-color);
    color: white;
}

.ai-input-area {
    display: flex;
    gap: 12px;
    align-items: flex-end;
    margin-bottom: 15px;
}

#ai-user-input {
    flex: 1;
    min-height: 60px;
    max-height: 150px;
    padding: 15px;
    border: 2px solid var(--comic-border);
    border-radius: 12px;
    background: var(--dark-bg);
    color: var(--dark-text);
    resize: none;
    font-family: 'Courier New', monospace;
    font-size: 0.95rem;
    line-height: 1.5;
}

#ai-user-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(255, 123, 0, 0.1);
}

.ai-send-button {
    background: var(--primary-color);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 0 var(--primary-dark);
}

.ai-send-button:hover {
    background: var(--accent-color);
    transform: translateY(2px);
    box-shadow: 0 2px 0 var(--primary-dark);
}

.ai-send-button:active {
    transform: translateY(4px);
    box-shadow: none;
}

/* Input Suggestions */
.ai-input-suggestions {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}

.ai-input-suggestions span {
    color: var(--secondary-color);
    font-size: 0.9rem;
}

.ai-suggestion-btn {
    background: rgba(255, 123, 0, 0.1);
    border: 1px solid var(--comic-border);
    color: var(--primary-color);
    padding: 6px 12px;
    border-radius: 16px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s;
}

.ai-suggestion-btn:hover {
    background: var(--primary-color);
    color: white;
    transform: translateY(-1px);
}

/* Typing Indicator */
.ai-typing-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 16px;
    background: var(--dark-card);
    border-radius: 18px;
    color: var(--secondary-color);
    font-style: italic;
    align-self: flex-start;
    border: 1px solid var(--comic-border);
}

.ai-typing-dots {
    display: flex;
    gap: 4px;
}

.ai-typing-dot {
    width: 6px;
    height: 6px;
    background: var(--primary-color);
    border-radius: 50%;
    animation: aiTyping 1.4s infinite ease-in-out;
}

.ai-typing-dot:nth-child(2) {
    animation-delay: 0.2s;
}

.ai-typing-dot:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes aiTyping {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-3px); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .ai-chat-fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
    }
    
    .ai-sidebar {
        position: absolute;
        left: -280px;
        top: 0;
        bottom: 0;
        z-index: 1001;
        transition: left 0.3s ease;
    }
    
    .ai-sidebar.show {
        left: 0;
    }
    
    .ai-message-bubble {
        max-width: 85%;
    }
    
    .ai-input-suggestions {
        flex-direction: column;
        align-items: flex-start;
    }
}

/* Code Syntax Highlighting */
.ai-code-block {
    background: #1e1e1;
    border-radius: 8px;
    overflow: hidden;
    margin: 10px 0;
    border: 1px solid #333;
}

.ai-code-header {
    background: #2d2d2d;
    padding: 8px 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem;
    color: #ccc;
}

.ai-code-content {
    padding: 12px;
    overflow-x: auto;
}

.ai-code-content pre {
    margin: 0;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    line-height: 1.4;
}

/* Scrollbar Styling */
.ai-chat-messages::-webkit-scrollbar {
    width: 6px;
}

.ai-chat-messages::-webkit-scrollbar-track {
    background: transparent;
}

.ai-chat-messages::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 3px;
}

.ai-chat-messages::-webkit-scrollbar-thumb:hover {
    background: var(--accent-color);
}
    </style>
</head>
<body>
    <!-- Notification Container -->
    <div class="notification-container" id="notification-container"></div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="share-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Bagikan Kode</h3>
                <button class="modal-close" id="close-share-modal">&times;</button>
            </div>
            <div class="share-options">
                <div class="share-option" data-platform="facebook">
                    <i class="fab fa-facebook"></i>
                    <span>Facebook</span>
                </div>
                <div class="share-option" data-platform="twitter">
                    <i class="fab fa-twitter"></i>
                    <span>Twitter</span>
                </div>
                <div class="share-option" data-platform="whatsapp">
                    <i class="fab fa-whatsapp"></i>
                    <span>WhatsApp</span>
                </div>
                <div class="share-option" data-platform="telegram">
                    <i class="fab fa-telegram"></i>
                    <span>Telegram</span>
                </div>
                <div class="share-option" data-platform="linkedin">
                    <i class="fab fa-linkedin"></i>
                    <span>LinkedIn</span>
                </div>
                <div class="share-option" data-platform="copy">
                    <i class="fas fa-copy"></i>
                    <span>Salin Link</span>
                </div>
            </div>
            <div class="share-link">
                <input type="text" id="share-url" readonly>
                <button class="copy-link-btn" id="copy-share-url">
                    <i class="fas fa-copy"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="material-icons">code</i>
                <span>CodeShare</span>
            </div>
            
            <nav class="nav-desktop">
                <a href="#" class="nav-item-desktop active" data-page="home">
                    <i class="material-icons">home</i>
                    <span>Beranda</span>
                </a>
                <a href="#" class="nav-item-desktop" data-page="search">
                    <i class="material-icons">search</i>
                    <span>Cari</span>
                </a>
                <a href="#" class="nav-item-desktop" data-page="leaderboard">
                    <i class="material-icons">leaderboard</i>
                    <span>Leaderboard</span>
                </a>
                <!-- Tambahkan menu AI -->
    <a href="#" class="nav-item" data-page="ai-chat">
        <i class="material-icons">smart_toy</i>
        <span>AI Chat</span>
    </a>
                <a href="#" class="nav-item-desktop" data-page="profile" id="profile-nav" style="display: none;">
                    <i class="material-icons">person</i>
                    <span>Profil</span>
                </a>
                <a href="#" class="nav-item" data-page="admin" id="admin-nav" style="display: none;">
                    <i class="material-icons">admin_panel_settings</i>
                    <span>Admin</span>
                </a>
            </nav>
            
            <div class="auth-buttons" id="auth-buttons">
                <button class="btn-outline comic-button" id="login-btn">Masuk</button>
                <button class="btn-primary comic-button" id="signup-btn">Daftar</button>
            </div>
            
            <div id="user-menu" style="display: none;">
                <button class="btn-outline comic-button" id="logout-btn">Keluar</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Home Page (Default Page) -->
        <section class="page active" id="home-page">
            <div class="welcome-container">
                <div class="card">
                    <h2>Selamat Datang di CodeShare</h2>
                    <p>Bagikan kode Anda dengan komunitas developer lainnya</p>
                    <div class="share-button-container">
                        <button class="btn-primary comic-button" id="share-code-btn">
                            <i class="material-icons">add</i>
                            Bagikan Kode
                        </button>
                        <button class="btn-outline comic-button" id="explore-btn">
                            <i class="material-icons">explore</i>
                            Jelajahi Kode
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="code-feed" id="code-feed">
                <div class="spinner"></div>
            </div>

            <div class="pagination" id="pagination">
                <!-- Pagination buttons will be added here -->
            </div>
        </section>

        <!-- Auth Page -->
        <section class="page" id="auth-page">
            <div class="auth-container">
                <div class="auth-tabs">
                    <div class="auth-tab active" id="login-tab">Masuk</div>
                    <div class="auth-tab" id="signup-tab">Daftar</div>
                </div>
                
                <div class="card">
                    <form id="auth-form">
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">Kata Sandi</label>
                            <input type="password" id="password" required>
                        </div>
                        
                        <button type="submit" class="btn-primary comic-button" id="auth-submit">Masuk</button>
                    </form>
                    
                    <div class="divider">
                        <span>atau</span>
                    </div>
                    
                    <div class="auth-providers">
                        <button class="btn-outline comic-button" id="google-login">
                            <i class="fab fa-google"></i>
                            Masuk dengan Google
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Search Page -->
        <section class="page" id="search-page">
            <div class="card search-container">
                <h2>Cari Kode</h2>
                <div class="form-group">
                    <input type="text" id="search-input" placeholder="Cari berdasarkan judul, bahasa, atau deskripsi...">
                </div>
                <button class="btn-primary comic-button" id="search-button">Cari</button>
            </div>
            
            <div class="search-results" id="search-results">
                <!-- Hasil pencarian akan ditampilkan di sini -->
            </div>
        </section>

        <!-- Share Code Page -->
        <section class="page" id="share-code-page">
            <div class="card">
                <h2>Bagikan Kode Anda</h2>
                
                <div class="form-group">
                    <label for="code-title">Judul Kode</label>
                    <input type="text" id="code-title" placeholder="Masukkan judul kode">
                </div>
                
                <div class="form-group">
                    <label for="code-description">Deskripsi</label>
                    <textarea id="code-description" rows="3" placeholder="Jelaskan tentang kode ini"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="code-language">Bahasa Pemrograman</label>
                    <select id="code-language">
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="cpp">C++</option>
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                        <option value="php">PHP</option>
                        <option value="ruby">Ruby</option>
                    </select>
                </div>
                
                <div class="code-editor-container">
                    <div class="code-editor-header">
                        <label for="code-editor">Kode</label>
                    </div>
                    <textarea id="code-editor" placeholder="Tempel kode Anda di sini"></textarea>
                </div>
                
                <button class="btn-primary comic-button" id="publish-code">Terbitkan</button>
            </div>
            
            <div class="card code-preview-container">
                <h3>Pratinjau</h3>
                <div id="code-preview">
                    <pre><code class="language-javascript">// Pratinjau kode akan muncul di sini</code></pre>
                </div>
            </div>
        </section>

        <!-- View Code Page -->
        <section class="page" id="view-code-page">
            <div class="view-code-header">
                <button class="btn-outline comic-button" id="back-button">
                    <i class="material-icons">arrow_back</i>
                    Kembali
                </button>
                <button class="btn-primary comic-button" id="share-code-button">
                    <i class="material-icons">share</i>
                    Bagikan
                </button>
            </div>
            
            <div class="card">
                <div class="code-card-header">
                    <img src="https://via.placeholder.com/40" alt="User Avatar" class="user-avatar" id="view-author-avatar">
                    <div class="user-info">
                        <div class="username">
                            <span id="view-author-name" class="clickable-username"></span>
                            <span class="verified-badge" id="view-verified-badge" style="display: none;">
                                <i class="fas fa-check-circle"></i>
                            </span>
                            <span class="admin-badge" id="view-admin-badge" style="display: none;">
                                <i class="fas fa-crown"></i>
                            </span>
                        </div>
                        <span class="code-language" id="view-code-language">JavaScript</span>
                    </div>
                </div>
                
                <h3 id="view-code-title"></h3>
                <p id="view-code-description"></p>
                
                <div class="code-stats">
                    <div class="code-stat">
                        <i class="material-icons">visibility</i>
                        <span id="view-code-views">0</span>
                    </div>
                    <div class="code-stat">
                        <i class="material-icons">content_copy</i>
                        <span id="view-code-copies">0</span>
                    </div>
                    <div class="code-stat">
                        <i class="material-icons">favorite</i>
                        <span id="view-code-likes">0</span>
                    </div>
                </div>
            </div>
            
            <div class="card code-container">
                <div class="code-actions">
                    <button class="copy-button comic-button" id="copy-code-button">
                        <i class="material-icons">content_copy</i>
                        Salin
                    </button>
                    <button class="copy-button comic-button" id="like-code-button">
                        <i class="material-icons">favorite_border</i>
                        Suka
                    </button>
                    <button class="copy-button comic-button delete-btn" id="delete-code-button" style="display: none;">
                        <i class="material-icons">delete</i>
                        Hapus
                    </button>
                </div>
                <pre><code class="language-javascript" id="view-code-content"></code></pre>
            </div>
        </section>

        <!-- Profile Page -->
        <section class="page" id="profile-page">
            <div class="card">
                <div class="profile-header">
                    <div class="profile-banner" id="profile-banner"></div>
                    <div class="profile-avatar-container">
                        <img src="https://via.placeholder.com/100" alt="Profile Avatar" class="profile-avatar" id="profile-avatar">
                    </div>
                </div>
                
                <div class="profile-content">
                    <div class="profile-info">
                        <div class="profile-name">
                            <span id="profile-display-name"></span>
                            <span class="verified-badge" id="profile-verified-badge" style="display: none;">
                                <i class="fas fa-check-circle"></i>
                            </span>
                            <span class="admin-badge" id="profile-admin-badge" style="display: none;">
                                <i class="fas fa-crown"></i>
                            </span>
                            <button class="btn-outline follow-btn" id="follow-btn" style="display: none;">
                                Ikuti
                            </button>
                        </div>
                        <p class="profile-bio" id="profile-bio"></p>
                        
                        <div class="social-links" id="social-links">
                            <!-- Social media links will be added here -->
                        </div>
                        
                        <div class="follow-stats">
                            <div class="follow-stat" id="followers-stat">
                                <div class="follow-stat-value" id="followers-count">0</div>
                                <div class="follow-stat-label">Pengikut</div>
                            </div>
                            <div class="follow-stat" id="following-stat">
                                <div class="follow-stat-value" id="following-count">0</div>
                                <div class="follow-stat-label">Mengikuti</div>
                            </div>
                            <div class="follow-stat">
                                <div class="follow-stat-value" id="profile-codes-count">0</div>
                                <div class="follow-stat-label">Kode</div>
                            </div>
                        </div>
                        
                        <div class="profile-stats">
                            <div class="profile-stat">
                                <div class="stat-value" id="profile-views-count">0</div>
                                <div class="stat-label">Total Dilihat</div>
                            </div>
                            <div class="profile-stat">
                                <div class="stat-value" id="profile-copies-count">0</div>
                                <div class="stat-label">Total Disalin</div>
                            </div>
                            <div class="profile-stat">
                                <div class="stat-value" id="profile-likes-count">0</div>
                                <div class="stat-label">Total Suka</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="profile-codes">
                <h3>Kode yang Dibagikan</h3>
                <div id="user-codes-list">
                    <div class="spinner"></div>
                </div>
            </div>
        </section>

        <!-- Edit Profile Page -->
        <section class="page" id="edit-profile-page">
            <div class="card">
                <h2>Edit Profil</h2>
                
                <div class="form-group">
                    <label for="edit-display-name">Nama Tampilan</label>
                    <input type="text" id="edit-display-name">
                </div>
                
                <div class="form-group">
                    <label for="edit-bio">Bio</label>
                    <textarea id="edit-bio" rows="3" placeholder="Ceritakan tentang diri Anda"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Media Sosial</label>
                    <div class="form-group">
                        <input type="url" id="edit-github" placeholder="URL GitHub">
                    </div>
                    <div class="form-group">
                        <input type="url" id="edit-instagram" placeholder="URL Instagram">
                    </div>
                    <div class="form-group">
                        <input type="url" id="edit-whatsapp" placeholder="URL WhatsApp">
                    </div>
                    <div class="form-group">
                        <input type="url" id="edit-website" placeholder="URL Website">
                    </div>
                </div>
                
                <div class="form-group image-upload-container">
                    <label>Foto Profil</label>
                    <div class="upload-btn-wrapper">
                        <button class="btn-outline comic-button">
                            <i class="material-icons">file_upload</i> Pilih Gambar
                        </button>
                        <input type="file" id="avatar-upload" accept="image/*">
                    </div>
                    <img src="https://via.placeholder.com/100" alt="Preview Avatar" class="avatar-preview" id="avatar-preview">
                    <div class="upload-progress" id="avatar-progress">
                        <div class="progress-bar" id="avatar-progress-bar"></div>
                    </div>
                </div>
                
                <div class="form-group image-upload-container">
                    <label>Banner Profil</label>
                    <div class="upload-btn-wrapper">
                        <button class="btn-outline comic-button">
                            <i class="material-icons">file_upload</i> Pilih Gambar
                        </button>
                        <input type="file" id="banner-upload" accept="image/*">
                    </div>
                    <img src="https://via.placeholder.com/800x200" alt="Preview Banner" class="image-preview" id="banner-preview">
                    <div class="upload-progress" id="banner-progress">
                        <div class="progress-bar" id="banner-progress-bar"></div>
                    </div>
                </div>
                
                <button class="btn-primary comic-button" id="save-profile-btn">Simpan Perubahan</button>
            </div>
        </section>

        <!-- Leaderboard Page -->
        <section class="page" id="leaderboard-page">
            <div class="card">
                <h2>Papan Peringkat</h2>
                <p>Pengguna dengan kode terbanyak yang dibagikan</p>
                
                <div class="leaderboard-list" id="leaderboard-list">
                    <div class="spinner"></div>
                </div>
            </div>
        </section>

        <!-- Admin Page -->
        <section class="page" id="admin-page">
            <div class="card">
                <h2>Panel Admin</h2>
                
                <div class="admin-stats">
                    <div class="admin-stat-card">
                        <div class="admin-stat-label">Total Pengguna</div>
                        <div class="admin-stat-value" id="admin-total-users">0</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-label">Total Kode</div>
                        <div class="admin-stat-value" id="admin-total-codes">0</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-label">Kode Hari Ini</div>
                        <div class="admin-stat-value" id="admin-today-codes">0</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-label">Total Views</div>
                        <div class="admin-stat-value" id="admin-total-views">0</div>
                    </div>
                </div>
                
                <div class="pixel-divider"></div>
                
                <div class="form-group">
                    <label for="user-search">Cari Pengguna</label>
                    <input type="text" id="user-search" placeholder="Masukkan email atau nama pengguna">
                    <button class="btn-primary comic-button" id="search-user-btn">Cari</button>
                </div>
                
                <div id="user-search-results">
                    <!-- Hasil pencarian pengguna akan ditampilkan di sini -->
                </div>
            </div>
        </section>
  
<!-- AI Chat Page - Full Screen -->
<section class="page" id="ai-chat-page">
    <div class="ai-chat-fullscreen">
        <!-- AI Chat Header -->
        <div class="ai-chat-header">
            <div class="ai-chat-title">
                <div class="ai-avatar">
                    <img src="https://files.catbox.moe/7w4b7n.jpg" alt="DinzAI Avatar">
                    <div class="ai-status"></div>
                </div>
                <div class="ai-title-content">
                    <h2>DinzAI Assistant</h2>
                    <p>AI Programming Assistant</p>
                </div>
            </div>
            <div class="ai-chat-controls">
                <button class="ai-control-btn" id="ai-minimize-btn">
                    <i class="material-icons">minimize</i>
                </button>
                <button class="ai-control-btn" id="ai-close-btn">
                    <i class="material-icons">close</i>
                </button>
            </div>
        </div>

        <!-- AI Chat Main Content -->
        <div class="ai-chat-main">
            <!-- AI Sidebar -->
            <div class="ai-sidebar">
                <div class="ai-sidebar-section">
                    <h3>AI Models</h3>
                    <div class="ai-model-list">
                        <div class="ai-model-item active" data-model="gemini">
                            <i class="fab fa-google"></i>
                            <span>Gemini</span>
                        </div>
                        <div class="ai-model-item" data-model="gpt3">
                            <i class="fab fa-openai"></i>
                            <span>GPT-3.5</span>
                        </div>
                        <div class="ai-model-item" data-model="gpt4">
                            <i class="fab fa-openai"></i>
                            <span>GPT-4</span>
                        </div>
                        <div class="ai-model-item" data-model="llama">
                            <i class="fas fa-robot"></i>
                            <span>Llama 3</span>
                        </div>
                        <div class="ai-model-item" data-model="claude">
                            <i class="fas fa-brain"></i>
                            <span>Claude</span>
                        </div>
                    </div>
                </div>

                <div class="ai-sidebar-section">
                    <h3>AI Mode</h3>
                    <div class="ai-mode-list">
                        <div class="ai-mode-item active" data-mode="asisten">
                            <i class="fas fa-user-tie"></i>
                            <span>Asisten</span>
                        </div>
                        <div class="ai-mode-item" data-mode="teman">
                            <i class="fas fa-user-friends"></i>
                            <span>Teman</span>
                        </div>
                        <div class="ai-mode-item" data-mode="ahli">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Ahli</span>
                        </div>
                        <div class="ai-mode-item" data-mode="pemula">
                            <i class="fas fa-book-open"></i>
                            <span>Pemula</span>
                        </div>
                    </div>
                </div>

                <div class="ai-sidebar-section">
                    <h3>Quick Actions</h3>
                    <div class="ai-quick-actions">
                        <button class="ai-quick-btn" data-action="explain-code">
                            <i class="fas fa-code"></i>
                            <span>Jelaskan Code</span>
                        </button>
                        <button class="ai-quick-btn" data-action="debug">
                            <i class="fas fa-bug"></i>
                            <span>Debug</span>
                        </button>
                        <button class="ai-quick-btn" data-action="optimize">
                            <i class="fas fa-bolt"></i>
                            <span>Optimasi</span>
                        </button>
                        <button class="ai-quick-btn" data-action="learn">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Belajar</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- AI Chat Content -->
            <div class="ai-chat-content">
                <div class="ai-chat-messages" id="ai-chat-messages">
                    <!-- Welcome Message -->
                    <div class="ai-welcome-message">
                        <div class="ai-message-bubble ai-bot-message">
                            <div class="ai-message-content">
                                <div class="ai-message-header">
                                    <span class="ai-sender">DinzAI</span>
                                    <span class="ai-time">Sekarang</span>
                                </div>
                                <div class="ai-message-text">
                                    <h3>👋 Halo! Saya DinzAI</h3>
                                    <p>Saya di sini untuk membantu Anda dengan:</p>
                                    <ul>
                                        <li>🛠️ Debugging dan problem solving</li>
                                        <li>📚 Penjelasan konsep programming</li>
                                        <li>⚡ Optimasi code</li>
                                        <li>🎓 Pembelajaran programming</li>
                                        <li>💡 Ide dan best practices</li>
                                    </ul>
                                    <p>Apa yang ingin Anda pelajari atau selesaikan hari ini?</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Chat Input -->
                <div class="ai-chat-input-container">
                    <div class="ai-input-tools">
                        <button class="ai-tool-btn" title="Upload Code">
                            <i class="fas fa-upload"></i>
                        </button>
                        <button class="ai-tool-btn" title="Format Code">
                            <i class="fas fa-indent"></i>
                        </button>
                        <button class="ai-tool-btn" title="Clear Chat">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    
                    <div class="ai-input-area">
                        <textarea 
                            id="ai-user-input" 
                            placeholder="Ketik pesan Anda atau paste code di sini..." 
                            rows="1"
                        ></textarea>
                        <button id="ai-send-btn" class="ai-send-button">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>

                    <div class="ai-input-suggestions">
                        <span>Coba tanyakan:</span>
                        <button class="ai-suggestion-btn" data-prompt="Cara fix error JavaScript">
                            "Cara fix error JavaScript"
                        </button>
                        <button class="ai-suggestion-btn" data-prompt="Jelaskan async await">
                            "Jelaskan async await"
                        </button>
                        <button class="ai-suggestion-btn" data-prompt="Optimasi Python code">
                            "Optimasi Python code"
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

        <!-- Followers/Following Page -->
        <section class="page" id="follow-page">
            <div class="card">
                <div class="view-code-header">
                    <button class="btn-outline comic-button" id="back-follow-button">
                        <i class="material-icons">arrow_back</i>
                        Kembali
                    </button>
                    <h2 id="follow-page-title">Pengikut</h2>
                </div>
                
                <div id="follow-list">
                    <!-- Daftar pengikut atau yang diikuti akan ditampilkan di sini -->
                </div>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-page="home">
            <i class="material-icons">home</i>
            <span>Beranda</span>
        </a>
        <a href="#" class="nav-item" data-page="search">
            <i class="material-icons">search</i>
            <span>Cari</span>
        </a>
        <a href="#" class="nav-item" data-page="leaderboard">
            <i class="material-icons">leaderboard</i>
            <span>Leaderboard</span>
        </a>
        <!-- Tambahkan menu AI -->
    <a href="#" class="nav-item" data-page="ai-chat">
        <i class="material-icons">smart_toy</i>
        <span>AI Chat</span>
    </a>
        <a href="#" class="nav-item" data-page="profile" id="profile-nav-mobile">
            <i class="material-icons">person</i>
            <span>Profil</span>
        </a>
    </nav>

    <script>
        // Konfigurasi Firebase - GANTI DENGAN KONFIGURASI ANDA
        const firebaseConfig = {
            apiKey: "AIzaSyATf0aEn7Kcsduk6ZnQ6tpxpMJO9HZLXOg",
            authDomain: "shareing-code.firebaseapp.com",
            projectId: "shareing-code",
            storageBucket: "shareing-code.firebasestorage.app",
            messagingSenderId: "843301763009",
            appId: "1:843301763009:web:66cf2a33d93afc8452a140"
        };

        // Konfigurasi GitHub - GANTI DENGAN KONFIGURASI ANDA
        const githubUsername = 'DinzID';
        const githubToken = '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';
        const repo = 'nyoba';
        const branch = 'main';
        const folderPath = 'images';

        // Daftar UID Admin - GANTI DENGAN UID ANDA
        const ADMIN_UIDS = [
            'bFyhJzrMbMdZtJkfl5sC95BNiTo2',
            'UID_ADMIN_2'
        ];
        
        // Konfigurasi AI
const AI_CONFIG = {
    gemini: {
        apiKey: 'AIzaSyBOwS78oDxGwbYrJjWJG2RmKroXp8PAV88',
        model: 'gemini-2.0-flash'
    },
    blackbox: {
        apiUrl: 'https://api.siputzx.my.id/api/ai/blackboxai'
    },
    deepseek: {
        apiUrl: 'https://api.siputzx.my.id/api/ai/deepseek-llm-67b-chat'
    },
    luminai: {
        apiUrl: 'https://api.siputzx.my.id/api/ai/luminai'
    },
    llama: {
        apiUrl: 'https://api.siputzx.my.id/api/ai/llama33'
    },
    mistral: {
        apiUrl: 'https://api.siputzx.my.id/api/ai/mistral'
    },
    qwq: {
        apiUrl: 'https://api.siputzx.my.id/api/ai/qwq-32b-preview'
    },
    perplexity: {
        apiUrl: 'https://api.siputzx.my.id/api/ai/perplexity'
    },
    'hutao-cai': {
        apiUrl: 'https://cai.neekoi.me/cai'
    },
    'gemini-beta': {
        apiUrl: 'https://api.siputzx.my.id/api/ai/gemini'
    },
    gpt3: {
        apiUrl: 'https://api.eypz.ct.ws/api/ai/gpt'
    },
    gpt4: {
        apiUrl: 'https://api.eypz.ct.ws/api/ai/gpt'
    },
    'flux-image': {
        apiUrl: 'https://api.siputzx.my.id/api/ai/flux'
    },
    'ghibli-image': {
        apiUrl: 'https://api.nekorinn.my.id/ai-img/text2ghibli'
    },
    'videogpt-video': {
        apiUrl: 'https://api.nekorinn.my.id/ai-vid/videogpt'
    }
};

const MODEL_NAMES = {
    gemini: 'gemini-2.0-flash',
    blackbox: 'blackbox',
    deepseek: 'deepseek-llm-67b-chat',
    luminai: 'luminai',
    llama: 'llama33',
    mistral: 'mistral',
    qwq: 'qwq-32b-preview',
    perplexity: 'perplexity',
    'hutao-cai': 'hutao-cai',
    'gemini-beta': 'gemini-beta',
    gpt3: 'gpt-3.5-turbo',
    gpt4: 'gpt-4',
    'flux-image': 'flux-image',
    'ghibli-image': 'ghibli-image',
    'videogpt-video': 'videogpt-video'
};

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // DOM Elements
        const pages = document.querySelectorAll('.page');
        const navItems = document.querySelectorAll('.nav-item, .nav-item-desktop');
        const authButtons = document.getElementById('auth-buttons');
        const userMenu = document.getElementById('user-menu');
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const authForm = document.getElementById('auth-form');
        const authSubmit = document.getElementById('auth-submit');
        const loginTab = document.getElementById('login-tab');
        const signupTab = document.getElementById('signup-tab');
        const googleLoginBtn = document.getElementById('google-login');
        const shareCodeBtn = document.getElementById('share-code-btn');
        const exploreBtn = document.getElementById('explore-btn');
        const publishCodeBtn = document.getElementById('publish-code');
        const codeEditor = document.getElementById('code-editor');
        const codePreview = document.getElementById('code-preview');
        const codeLanguage = document.getElementById('code-language');
        const backButton = document.getElementById('back-button');
        const backFollowButton = document.getElementById('back-follow-button');
        const copyCodeButton = document.getElementById('copy-code-button');
        const likeCodeButton = document.getElementById('like-code-button');
        const deleteCodeButton = document.getElementById('delete-code-button');
        const profileNav = document.getElementById('profile-nav');
        const profileNavMobile = document.getElementById('profile-nav-mobile');
        const saveProfileBtn = document.getElementById('save-profile-btn');
        const avatarUpload = document.getElementById('avatar-upload');
        const avatarPreview = document.getElementById('avatar-preview');
        const avatarProgress = document.getElementById('avatar-progress');
        const avatarProgressBar = document.getElementById('avatar-progress-bar');
        const bannerUpload = document.getElementById('banner-upload');
        const bannerPreview = document.getElementById('banner-preview');
        const bannerProgress = document.getElementById('banner-progress');
        const bannerProgressBar = document.getElementById('banner-progress-bar');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const searchResults = document.getElementById('search-results');
        const userSearch = document.getElementById('user-search');
        const searchUserBtn = document.getElementById('search-user-btn');
        const userSearchResults = document.getElementById('user-search-results');
        const adminNav = document.getElementById('admin-nav');
        const paginationContainer = document.getElementById('pagination');
        const shareModal = document.getElementById('share-modal');
        const closeShareModal = document.getElementById('close-share-modal');
        const shareCodeButton = document.getElementById('share-code-button');
        const shareOptions = document.querySelectorAll('.share-option');
        const shareUrlInput = document.getElementById('share-url');
        const copyShareUrlBtn = document.getElementById('copy-share-url');
        const followBtn = document.getElementById('follow-btn');
        const followersStat = document.getElementById('followers-stat');
        const followingStat = document.getElementById('following-stat');
        const followersCount = document.getElementById('followers-count');
        const followingCount = document.getElementById('following-count');
        const followList = document.getElementById('follow-list');
        const followPageTitle = document.getElementById('follow-page-title');
         const aiChatMessages = document.getElementById('ai-chat-messages');
const aiUserInput = document.getElementById('ai-user-input');
const aiSendBtn = document.getElementById('ai-send-btn');
const aiOptionBtns = document.querySelectorAll('.ai-option-btn');
        // State variables
        // State variables untuk AI
        let currentAIModel = 'gemini';
        let currentAIMode = 'asisten';
        let conversationHistory = [];
        let currentUser = null;
        let isLoginMode = true;
        let currentViewingCodeId = null;
        let currentViewingProfileId = null;
        let adminStats = {
            totalUsers: 0,
            totalCodes: 0,
            todayCodes: 0,
            totalViews: 0
        };
        let currentPage = 1;
        const codesPerPage = 5;
        let totalCodes = 0;
        let lastVisibleDoc = null;
        let firstVisibleDoc = null;
        let followData = {
            followers: [],
            following: []
        };

 // Panggil setup function di init

// Panggil di init function
function init() {
    setupEventListeners();
    setupAIChatListeners();
    setupAIChatFullScreen(); // Tambahkan ini
    checkAuthState();
    
   
    
    // Handle initial URL
    const params = parseUrlParams();
    if (params.code) {
        // Load the code directly from the shared link
        viewCode(params.code);
    } else {
        // Default to home page
        showPage('home-page');
        loadCodeFeed('first');
    }
    
    // Listen for hash changes
    window.addEventListener('hashchange', handleUrlChanges);
}

    function setupAIChatListeners() {
    // Navigasi ke halaman AI chat
    document.querySelectorAll('[data-page="ai-chat"]').forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('ai-chat-page');
        });
    });
    
    // Kirim pesan AI
    aiSendBtn.addEventListener('click', sendAIMessage);
    aiUserInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendAIMessage();
        }
    });
    
    // Tombol prompt cepat
    aiOptionBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            const promptType = e.currentTarget.dataset.prompt;
            handleQuickPrompt(promptType);
        });
    });
}
        // Set up event listeners
        function setupEventListeners() {
            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = `${item.dataset.page}-page`;
                    
                    if (pageId === 'leaderboard-page') {
                        loadLeaderboard();
                    } else if (pageId === 'admin-page') {
                        loadAdminStats();
                    }
                    
                    showPage(pageId);
                    
                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                });
            });

            // Auth tabs
            loginTab.addEventListener('click', () => switchAuthMode(true));
            signupTab.addEventListener('click', () => switchAuthMode(false));

            // Auth buttons
            loginBtn.addEventListener('click', () => showPage('auth-page'));
            signupBtn.addEventListener('click', () => {
                switchAuthMode(false);
                showPage('auth-page');
            });
            logoutBtn.addEventListener('click', handleLogout);

            // Auth form
            authForm.addEventListener('submit', handleAuthSubmit);
            googleLoginBtn.addEventListener('click', handleGoogleLogin);

            // Code sharing
            shareCodeBtn.addEventListener('click', () => {
                if (currentUser) {
                    showPage('share-code-page');
                } else {
                    showPage('auth-page');
                    showNotification('Silakan masuk untuk berbagi kode', 'info');
                }
            });

            exploreBtn.addEventListener('click', () => {
                loadCodeFeed('first');
            });

            publishCodeBtn.addEventListener('click', handlePublishCode);
            codeEditor.addEventListener('input', updateCodePreview);
            codeLanguage.addEventListener('change', updateCodePreview);

            // View code
            backButton.addEventListener('click', () => showPage('home-page'));
            backFollowButton.addEventListener('click', () => {
                if (currentViewingProfileId) {
                    loadProfilePage(currentViewingProfileId);
                    showPage('profile-page');
                } else {
                    showPage('home-page');
                }
            });
            copyCodeButton.addEventListener('click', handleCopyCode);
            likeCodeButton.addEventListener('click', handleLikeCode);
            deleteCodeButton.addEventListener('click', handleDeleteCode);
            shareCodeButton.addEventListener('click', showShareModal);

            // Profile
            profileNav.addEventListener('click', (e) => {
                e.preventDefault();
                loadProfilePage(currentUser.uid);
                showPage('profile-page');
            });

            profileNavMobile.addEventListener('click', (e) => {
                e.preventDefault();
                loadProfilePage(currentUser.uid);
                showPage('profile-page');
            });

            // Edit profile
            saveProfileBtn.addEventListener('click', handleSaveProfile);
            
            // Image uploads
            avatarUpload.addEventListener('change', (e) => {
                handleImageUpload(e.target.files[0], 'avatar');
            });
            
            bannerUpload.addEventListener('change', (e) => {
                handleImageUpload(e.target.files[0], 'banner');
            });

            // Search
            searchButton.addEventListener('click', handleSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSearch();
            });

            // Admin
            searchUserBtn.addEventListener('click', handleUserSearch);

            // Share modal
            closeShareModal.addEventListener('click', () => {
                shareModal.style.display = 'none';
            });

            shareOptions.forEach(option => {
                option.addEventListener('click', (e) => {
                    const platform = e.currentTarget.dataset.platform;
                    shareToPlatform(platform);
                });
            });

            copyShareUrlBtn.addEventListener('click', copyShareUrl);

            // Follow button
            followBtn.addEventListener('click', handleFollow);

            // Follow stats
            followersStat.addEventListener('click', () => {
                loadFollowList('followers');
            });

            followingStat.addEventListener('click', () => {
                loadFollowList('following');
            });

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === shareModal) {
                    shareModal.style.display = 'none';
                }
            });
        }
        
// Setup event listeners for AI chat


// Kirim pesan ke AI
async function sendAIMessage() {
    const message = aiUserInput.value.trim();
    if (!message) return;
    
    // Tambahkan pesan user ke chat
    addAIMessage(message, 'user');
    aiUserInput.value = '';
    
    // Tampilkan typing indicator
    showAITyping();
    
    try {
        // Kirim ke API AI (contoh menggunakan Gemini)
        const response = await fetchAIResponse(message);
        removeAITyping();
        addAIMessage(response, 'bot');
    } catch (error) {
        removeAITyping();
        addAIMessage('Maaf, terjadi error. Silakan coba lagi nanti.', 'bot');
        console.error('AI Error:', error);
    }
}

// Fungsi AI dari code sebelumnya
async function fetchAIResponse(message) {
    try {
        if (currentAIModel === 'gemini') {
            return await sendGeminiMessage(message);
        } 
        else if (currentAIModel === 'flux-image' || currentAIModel === 'ghibli-image') {
            return await generateImage(message);
        }
        else if (currentAIModel === 'videogpt-video') {
            return await generateVideo(message);
        }
        else {
            return await sendOtherModelMessage(message);
        }
    } catch (error) {
        console.error('AI Error:', error);
        return `Maaf, terjadi error: ${error.message}. Coba lagi nanti atau pilih model lain.`;
    }
}

async function sendGeminiMessage(message) {
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAMES.gemini}:generateContent?key=${AI_CONFIG.gemini.apiKey}`;
    
    const systemPrompt = getSystemPrompt();
    
    const contents = conversationHistory.slice(-10).map(msg => {
        return {
            role: msg.sender === 'user' ? 'user' : 'model',
            parts: [{ text: msg.text }]
        };
    });
    
    // Tambahkan pesan terbaru
    contents.push({
        role: 'user',
        parts: [{ text: message }]
    });
    
    const response = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            contents: contents,
            systemInstruction: { parts: [{ text: systemPrompt }] }
        })
    });

    if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error?.message || `HTTP error! Status: ${response.status}`);
    }
    
    const data = await response.json();
    
    if (data.candidates && data.candidates[0].content.parts[0].text) {
        const aiText = data.candidates[0].content.parts[0].text;
        
        // Simpan ke history
        conversationHistory.push({ text: message, sender: 'user' });
        conversationHistory.push({ text: aiText, sender: 'bot' });
        
        // Keep history manageable
        if (conversationHistory.length > 20) {
            conversationHistory = conversationHistory.slice(-20);
        }
        
        return aiText;
    } else {
        throw new Error('Jawaban kosong atau tidak valid dari API.');
    }
}

async function sendOtherModelMessage(message) {
    const config = AI_CONFIG[currentAIModel];
    if (!config || !config.apiUrl) {
        throw new Error('Model tidak dikenali atau tidak dikonfigurasi');
    }
    
    let url = config.apiUrl;
    const encodedPrompt = encodeURIComponent(message);
    
    // Format URL berdasarkan model
    switch (currentAIModel) {
        case 'blackbox':
        case 'deepseek':
        case 'luminai':
        case 'qwq':
        case 'perplexity':
            url += `?content=${encodedPrompt}`;
            break;
        case 'llama':
            url += `?prompt=nama%20kamu%20adalah%20DinzAI%20kamu%20adalah%20asisten%20programming&text=${encodedPrompt}`;
            break;
        case 'mistral':
            url += `?prompt=Nama%20kamu%20adalah%20DinzAI&message=${encodedPrompt}`;
            break;
        case 'hutao-cai':
            url += `?char=FRdKHnLG4JF6I14PexPWFvVyfrp-nZi6NFcoljmPPPM&message=${encodedPrompt}`;
            break;
        case 'gemini-beta':
            url += `?text=${encodedPrompt}&cookie=sb%3DRn8BYQvCEb2fpMQZjsd6L382%3B%20datr%3DRn8BYbyhXgw9RlOvmsosmVNT%3B%20c_user%3D100003164630629%3B%20_fbp%3Dfb.1.1629876126997.444699739%3B%20wd%3D1920x939%3B%20spin%3Dr.1004812505_b.trunk_t.1638730393_s.1_v.2_%3B%20xs%3D28%253A8ROnP0aeVF8XcQ%253A2%253A1627488145%253A-1%253A4916%253A%253AAcWIuSjPy2mlTPuZAeA2wWzHzEDuumXI89jH8a_QIV8%3B%20fr%3D0jQw7hcrFdas2ZeyT.AWVpRNl_4noCEs_hb8kaZahs-jA.BhrQqa.3E.AAA.0.0.BhrQqa.AWUu879ZtCw&promptSystem=kamu%20adalah%20asisten%20programming%20yang%20bernama%20DinzAI`;
            break;
        case 'gpt3':
        case 'gpt4':
            url += `?text=${encodedPrompt}&model=${currentAIModel}`;
            break;
    }
    
    const response = await fetch(url);
    
    if (!response.ok) {
        throw new Error(`Model ${currentAIModel} tidak merespons (status ${response.status})`);
    }
    
    const data = await response.json();
    console.log('Response dari API:', data);
    
    let aiText = '';
    if (data.response) {
        aiText = data.response;
    } else if (data.data && typeof data.data === 'string') {
        aiText = data.data;
    } else if (data.data && data.data.output) {
        aiText = data.data.output;
    } else {
        aiText = JSON.stringify(data, null, 2);
    }
    
    // Simpan ke history
    conversationHistory.push({ text: message, sender: 'user' });
    conversationHistory.push({ text: aiText, sender: 'bot' });
    
    return aiText;
}

async function generateImage(prompt) {
    try {
        const encodedPrompt = encodeURIComponent(prompt);
        let apiUrl;
        
        if (currentAIModel === 'flux-image') {
            apiUrl = `${AI_CONFIG['flux-image'].apiUrl}?prompt=${encodedPrompt}`;
        } else if (currentAIModel === 'ghibli-image') {
            apiUrl = `${AI_CONFIG['ghibli-image'].apiUrl}?text=${encodedPrompt}`;
        } else {
            throw new Error('Model gambar tidak dikenali');
        }
        
        const response = await fetch(apiUrl);
        
        if (!response.ok) throw new Error('Gagal membuat gambar');
        
        const blob = await response.blob();
        const reader = new FileReader();
        
        return new Promise((resolve) => {
            reader.onload = () => {
                const base64data = reader.result.split(',')[1];
                resolve(`![Gambar](${reader.result})`);
            };
            reader.readAsDataURL(blob);
        });
        
    } catch (error) {
        console.error("Error generating image:", error);
        return `Maaf, aku gagal membuat gambarnya. Error: ${error.message}`;
    }
}

async function generateVideo(prompt) {
    try {
        const encodedPrompt = encodeURIComponent(prompt);
        const response = await fetch(`${AI_CONFIG['videogpt-video'].apiUrl}?text=${encodedPrompt}`);
        
        if (!response.ok) {
            throw new Error(`Gagal membuat video (status ${response.status})`);
        }
        
        const data = await response.json();
        if (!data.videoUrl) {
            throw new Error('Tidak mendapatkan URL video dari respons');
        }
        
        return `Video telah dibuat: [Tonton Video](${data.videoUrl})`;
        
    } catch (error) {
        console.error("Error generating video:", error);
        return `Maaf, aku gagal membuat videonya. Error: ${error.message}`;
    }
}

function getSystemPrompt() {
    const baseRule = "Anda adalah DinzAI, asisten programming yang membantu developer dengan pertanyaan coding, debugging, dan konsep pemrograman. Berikan jawaban yang jelas, informatif, dan langsung ke inti permasalahan.";
    
    const modePrompts = {
        'asisten': `${baseRule} Jawab dengan profesional dan membantu.`,
        'teman': `${baseRule} Jawab dengan santai dan friendly seperti teman.`,
        'ahli': `${baseRule} Jawab dengan sangat teknis dan detail seperti expert.`,
        'pemula': `${baseRule} Jawab dengan sederhana dan mudah dimengerti untuk pemula.`
    };
    
    return modePrompts[currentAIMode] || modePrompts['asisten'];
}

// Tambahkan pesan ke chat
function addAIMessage(text, sender) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `ai-message-bubble ai-${sender}-message`;
    
    const messageText = document.createElement('div');
    messageText.textContent = text;
    
    const timeSpan = document.createElement('div');
    timeSpan.className = 'ai-message-time';
    timeSpan.textContent = new Date().toLocaleTimeString();
    
    messageDiv.appendChild(messageText);
    messageDiv.appendChild(timeSpan);
    aiChatMessages.appendChild(messageDiv);
    
    // Scroll ke bawah
    aiChatMessages.scrollTop = aiChatMessages.scrollHeight;
}

// Tampilkan typing indicator
function showAITyping() {
    const typingDiv = document.createElement('div');
    typingDiv.className = 'ai-typing-indicator';
    typingDiv.id = 'ai-typing-indicator';
    
    typingDiv.innerHTML = `
        <span>AI sedang mengetik</span>
        <span class="ai-typing-dot"></span>
        <span class="ai-typing-dot"></span>
        <span class="ai-typing-dot"></span>
    `;
    
    aiChatMessages.appendChild(typingDiv);
    aiChatMessages.scrollTop = aiChatMessages.scrollHeight;
}

// Hapus typing indicator
function removeAITyping() {
    const typingIndicator = document.getElementById('ai-typing-indicator');
    if (typingIndicator) {
        typingIndicator.remove();
    }
}

// Handle quick prompt buttons
function handleQuickPrompt(promptType) {
    let promptText = '';
    
    switch(promptType) {
        case 'help':
            promptText = 'Bantu saya memahami konsep programming ini: ';
            break;
        case 'debug':
            promptText = 'Bantu saya debug kode berikut: \n\n';
            break;
        case 'explain':
            promptText = 'Jelaskan konsep programming berikut: ';
            break;
    }
    
    aiUserInput.value = promptText;
    aiUserInput.focus();
}



        // Show a specific page and update URL hash
// Show a specific page
function showPage(pageId) {
    pages.forEach(page => {
        page.classList.remove('active');
    });
    document.getElementById(pageId).classList.add('active');
    
    // Load data jika diperlukan
    if (pageId === 'home-page') {
        loadCodeFeed('first');
    } else if (pageId === 'ai-chat-page') {
        // Reset chat atau load history jika ada
        aiChatMessages.innerHTML = '';
        // Tampilkan welcome message
        const welcomeMsg = document.querySelector('.ai-welcome-message');
        if (welcomeMsg) {
            aiChatMessages.appendChild(welcomeMsg.cloneNode(true));
        }
    }
}

// Parse URL parameters and hash
function parseUrlParams() {
    const params = {};
    const hash = window.location.hash.substr(1);
    
    if (hash.includes('=')) {
        const [key, value] = hash.split('=');
        params[key] = value;
    } else if (hash) {
        params.page = hash;
    }
    
    // Also check for query parameters
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    
    for (const [key, value] of urlParams.entries()) {
        params[key] = value;
    }
    
    return params;
}

// Handle URL changes
function handleUrlChanges() {
    const params = parseUrlParams();
    
    if (params.code) {
        // Directly view the code from the shared link
        viewCode(params.code);
    } else if (params.page) {
        // Navigate to the specified page
        const pageId = `${params.page}-page`;
        if (document.getElementById(pageId)) {
            showPage(pageId);
            
            // Update active nav item
            navItems.forEach(nav => {
                if (nav.dataset.page === params.page) {
                    nav.classList.add('active');
                } else {
                    nav.classList.remove('active');
                }
            });
            
            // Load page-specific data
            if (params.page === 'leaderboard') {
                loadLeaderboard();
            } else if (params.page === 'ai-chat') {
        // Handle direct access to AI chat
             } else if (currentUser) {
            showPage('ai-chat-page');
            } else if (params.page === 'admin') {
                loadAdminStats();
            }
        }
    }
}
        // Switch between login and signup mode
        function switchAuthMode(loginMode) {
            isLoginMode = loginMode;
            
            if (loginMode) {
                loginTab.classList.add('active');
                signupTab.classList.remove('active');
                authSubmit.textContent = 'Masuk';
                authForm.dataset.mode = 'login';
            } else {
                loginTab.classList.remove('active');
                signupTab.classList.add('active');
                authSubmit.textContent = 'Daftar';
                authForm.dataset.mode = 'signup';
            }
        }

        // Check authentication state
        // Check authentication state
function checkAuthState() {
    auth.onAuthStateChanged(async (user) => {
        if (user) {
            currentUser = user;
            authButtons.style.display = 'none';
            userMenu.style.display = 'block';
            profileNav.style.display = 'flex';
            profileNavMobile.style.display = 'flex';
            
            // Tampilkan menu AI untuk semua user yang login
            document.querySelectorAll('[data-page="ai-chat"]').forEach(item => {
                item.style.display = 'flex';
            });
            
            // Check if user is admin
            await checkAdminStatus(user.uid);
            
        } else {
            // Tidak ada user yang login
            currentUser = null;
            authButtons.style.display = 'flex';
            userMenu.style.display = 'none';
            profileNav.style.display = 'none';
            profileNavMobile.style.display = 'none';
            adminNav.style.display = 'none';
            
            // Sembunyikan menu AI
            document.querySelectorAll('[data-page="ai-chat"]').forEach(item => {
                item.style.display = 'none';
            });
        }
    });
}

// Full Screen AI Chat Functions
function setupAIChatFullScreen() {
    // Minimize button
    document.getElementById('ai-minimize-btn').addEventListener('click', () => {
        showPage('home-page');
    });
    
    // Close button
    document.getElementById('ai-close-btn').addEventListener('click', () => {
        showPage('home-page');
    });
    
    // Model selection
    document.querySelectorAll('.ai-model-item').forEach(item => {
        item.addEventListener('click', () => {
            document.querySelectorAll('.ai-model-item').forEach(i => i.classList.remove('active'));
            item.classList.add('active');
            changeAIModel(item.dataset.model);
        });
    });
    
    // Mode selection
    document.querySelectorAll('.ai-mode-item').forEach(item => {
        item.addEventListener('click', () => {
            document.querySelectorAll('.ai-mode-item').forEach(i => i.classList.remove('active'));
            item.classList.add('active');
            changeAIMode(item.dataset.mode);
        });
    });
    
    // Quick actions
    document.querySelectorAll('.ai-quick-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const action = btn.dataset.action;
            handleQuickAction(action);
        });
    });
    
    // Suggestions
    document.querySelectorAll('.ai-suggestion-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            aiUserInput.value = btn.dataset.prompt;
            aiUserInput.focus();
        });
    });
    
    // Tool buttons
    document.querySelectorAll('.ai-tool-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const tool = btn.querySelector('i').className;
            handleAITool(tool);
        });
    });
}

function handleQuickAction(action) {
    const prompts = {
        'explain-code': 'Bisa jelaskan code ini: [paste code Anda di sini]',
        'debug': 'Saya punya error: [deskripsi error atau paste code error]',
        'optimize': 'Bantu optimasi code ini: [paste code Anda di sini]',
        'learn': 'Saya ingin belajar tentang: [topik programming]'
    };
    
    aiUserInput.value = prompts[action] || '';
    aiUserInput.focus();
    addAIMessage(`Mode ${action} dipilih. Silakan isi detailnya.`, 'system');
}

function handleAITool(tool) {
    if (tool.includes('fa-upload')) {
        // Handle code upload
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.js,.py,.java,.cpp,.html,.css,.php,.rb,.go,.ts';
        input.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    aiUserInput.value = `File: ${file.name}\n\n${e.target.result}`;
                };
                reader.readAsText(file);
            }
        };
        input.click();
    }
    else if (tool.includes('fa-indent')) {
        // Format code
        const code = aiUserInput.value;
        // Simple formatting - bisa ditambah dengan library prettier nanti
        aiUserInput.value = code.replace(/;/g, ';\n').replace(/{/g, ' {\n').replace(/}/g, '\n}');
    }
    else if (tool.includes('fa-trash')) {
        // Clear chat
        if (confirm('Apakah Anda yakin ingin menghapus semua percakapan?')) {
            conversationHistory = [];
            document.getElementById('ai-chat-messages').innerHTML = '';
            const welcomeMsg = document.querySelector('.ai-welcome-message');
            if (welcomeMsg) {
                document.getElementById('ai-chat-messages').appendChild(welcomeMsg.cloneNode(true));
            }
        }
    }
}


        // Handle authentication form submission
        async function handleAuthSubmit(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                if (isLoginMode) {
                    // Login with email and password
                    await auth.signInWithEmailAndPassword(email, password);
                    showNotification('Berhasil masuk!', 'success');
                    showPage('home-page');
                } else {
                    // Sign up with email and password
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const name = email.split('@')[0];
                    
                    // Update profile dengan nama pengguna
                    await userCredential.user.updateProfile({
                        displayName: name
                    });
                    
                    // Create user profile di Firestore
                    await db.collection('profiles').doc(userCredential.user.uid).set({
                        user_id: userCredential.user.uid,
                        display_name: name,
                        email: email,
                        avatar_url: '',
                        banner_url: '',
                        bio: '',
                        social_links: {
                            github: '',
                            instagram: '',
                            whatsapp: '',
                            website: ''
                        },
                        codes_shared: 0,
                        total_views: 0,
                        total_copies: 0,
                        total_likes: 0,
                        followers_count: 0,
                        following_count: 0,
                        is_verified: false,
                        is_admin: ADMIN_UIDS.includes(userCredential.user.uid),
                        created_at: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    showNotification('Akun berhasil dibuat!', 'success');
                    showPage('home-page');
                }
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // Handle Google login
        async function handleGoogleLogin() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const userCredential = await auth.signInWithPopup(provider);
                
                // Check if user profile exists, if not create one
                const profileDoc = await db.collection('profiles').doc(userCredential.user.uid).get();
                if (!profileDoc.exists) {
                    await db.collection('profiles').doc(userCredential.user.uid).set({
                        user_id: userCredential.user.uid,
                        display_name: userCredential.user.displayName,
                        email: userCredential.user.email,
                        avatar_url: userCredential.user.photoURL || '',
                        banner_url: '',
                        bio: '',
                        social_links: {
                            github: '',
                            instagram: '',
                            whatsapp: '',
                            website: ''
                        },
                        codes_shared: 0,
                        total_views: 0,
                        total_copies: 0,
                        total_likes: 0,
                        followers_count: 0,
                        following_count: 0,
                        is_verified: false,
                        is_admin: ADMIN_UIDS.includes(userCredential.user.uid),
                        created_at: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                showNotification('Berhasil login dengan Google!', 'success');
                showPage('home-page');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // Handle logout
        async function handleLogout() {
            try {
                await auth.signOut();
                showNotification('Berhasil keluar', 'success');
                showPage('home-page');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // Update code preview
        function updateCodePreview() {
            const code = codeEditor.value;
            const language = codeLanguage.value;
            
            // Escape HTML sebelum ditampilkan
            const escapedCode = escapeHtml(code);
            
            codePreview.innerHTML = `<pre><code class="language-${language}">${escapedCode}</code></pre>`;
            
            // Apply syntax highlighting
            setTimeout(() => {
                const codeElement = codePreview.querySelector('code');
                if (codeElement) {
                    hljs.highlightElement(codeElement);
                }
            }, 0);
        }

        // Handle publishing code
        async function handlePublishCode() {
            if (!currentUser) {
                showNotification('Silakan masuk untuk berbagi kode', 'info');
                showPage('auth-page');
                return;
            }
            
            const title = document.getElementById('code-title').value;
            const description = document.getElementById('code-description').value;
            const language = codeLanguage.value;
            const code = codeEditor.value;
            
            if (!title || !code) {
                showNotification('Judul dan kode tidak boleh kosong', 'error');
                return;
            }
            
            try {
                // Get user profile to check if verified
                const profileDoc = await db.collection('profiles').doc(currentUser.uid).get();
                const profile = profileDoc.data();
                
                const isVerified = profile ? profile.is_verified : false;
                
                // Add code to Firestore
                await db.collection('codes').add({
                    title: title,
                    description: description,
                    language: language,
                    code: code,
                    author_id: currentUser.uid,
                    author_name: currentUser.displayName || profile.display_name,
                    author_avatar: profile.avatar_url || '',
                    author_verified: isVerified,
                    author_admin: profile.is_admin || false,
                    views: 0,
                    copies: 0,
                    likes: 0,
                    liked_by: [],
                    created_at: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update user's codes shared count
                if (profile) {
                    await db.collection('profiles').doc(currentUser.uid).update({
                        codes_shared: firebase.firestore.FieldValue.increment(1)
                    });
                }
                
                // Reset form
                document.getElementById('code-title').value = '';
                document.getElementById('code-description').value = '';
                codeEditor.value = '';
                
                showPage('home-page');
                showNotification('Kode berhasil dibagikan!', 'success');
                loadCodeFeed('first');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // Load code feed with pagination
        async function loadCodeFeed(direction = 'first') {
            const codeFeed = document.getElementById('code-feed');
            codeFeed.innerHTML = '<div class="spinner"></div>';
            
            try {
                let query = db.collection('codes')
                    .orderBy('created_at', 'desc')
                    .limit(codesPerPage);
                
                // Handle pagination based on direction
                if (direction === 'next' && lastVisibleDoc) {
                    query = query.startAfter(lastVisibleDoc);
                } else if (direction === 'prev' && firstVisibleDoc) {
                    query = query.endBefore(firstVisibleDoc).limitToLast(codesPerPage);
                }
                
                const codesSnapshot = await query.get();
                
                codeFeed.innerHTML = '';
                
                if (codesSnapshot.empty) {
                    codeFeed.innerHTML = '<p class="text-center">Belum ada kode yang dibagikan</p>';
                    paginationContainer.innerHTML = '';
                    return;
                }
                
                // Update pagination markers
                firstVisibleDoc = codesSnapshot.docs[0];
                lastVisibleDoc = codesSnapshot.docs[codesSnapshot.docs.length - 1];
                
                // Get total count for pagination info
                const countSnapshot = await db.collection('codes').get();
                totalCodes = countSnapshot.size;
                const totalPages = Math.ceil(totalCodes / codesPerPage);
                
                // Calculate current page
                if (direction === 'first') {
                    currentPage = 1;
                } else if (direction === 'next') {
                    currentPage++;
                } else if (direction === 'prev') {
                    currentPage--;
                }
                
                codesSnapshot.forEach(doc => {
                    const code = doc.data();
                    const codeId = doc.id;
                    
                    // Escape semua data yang akan ditampilkan
                    const safeTitle = escapeHtml(code.title);
                    const safeDescription = code.description ? escapeHtml(code.description) : '';
                    const safeCode = escapeHtml(code.code);
                    const safeDisplayName = escapeHtml(code.author_name);
                    
                    const codeCard = document.createElement('div');
                    codeCard.className = 'card code-card';
                    codeCard.dataset.id = codeId;
                    
                    codeCard.innerHTML = `
                        <div class="code-card-header">
                            <img src="${code.author_avatar || 'https://via.placeholder.com/40'}" alt="User Avatar" class="user-avatar" onerror="this.src='https://via.placeholder.com/40'">
                            <div class="user-info">
                                <div class="username">
                                    <span class="clickable-username" data-userid="${code.author_id}">${safeDisplayName}</span>
                                    ${code.author_verified ? '<span class="verified-badge"><i class="fas fa-check-circle"></i></span>' : ''}
                                    ${code.author_admin ? '<span class="admin-badge"><i class="fas fa-crown"></i></span>' : ''}
                                </div>
                                <span class="code-language">${escapeHtml(code.language)}</span>
                            </div>
                        </div>
                        
                        <h3>${safeTitle}</h3>
                        ${safeDescription ? `<p>${safeDescription}</p>` : ''}
                        
                        <div class="code-preview">
                            <pre><code class="language-${code.language}">${safeCode}</code></pre>
                        </div>
                        
                        <div class="code-stats">
                            <div class="code-stat">
                                <i class="material-icons">visibility</i>
                                <span>${code.views || 0}</span>
                            </div>
                            <div class="code-stat">
                                <i class="material-icons">content_copy</i>
                                <span>${code.copies || 0}</span>
                            </div>
                            <div class="code-stat">
                                <i class="material-icons">favorite</i>
                                <span>${code.likes || 0}</span>
                            </div>
                        </div>
                    `;
                    
                    // Apply syntax highlighting
                    setTimeout(() => {
                        const codeElement = codeCard.querySelector('code');
                        if (codeElement) {
                            hljs.highlightElement(codeElement);
                        }
                    }, 0);
                    
                    // Add click event to view code
                    codeCard.addEventListener('click', (e) => {
                        // Jika yang diklik adalah username, jangan trigger view code
                        if (!e.target.classList.contains('clickable-username')) {
                            viewCode(codeId);
                        }
                    });
                    
                    // Add click event to username for profile view
                    const usernameElement = codeCard.querySelector('.clickable-username');
                    usernameElement.addEventListener('click', (e) => {
                        e.stopPropagation(); // Mencegah event bubbling ke parent
                        const userId = e.target.dataset.userid;
                        loadProfilePage(userId);
                        showPage('profile-page');
                    });
                    
                    codeFeed.appendChild(codeCard);
                });
                
                // Add pagination buttons
                updatePaginationButtons(totalPages);
                
            } catch (error) {
                console.error('Error loading code feed:', error);
                codeFeed.innerHTML = '<p class="text-center">Gagal memuat kode</p>';
                showNotification('Gagal memuat kode: ' + error.message, 'error');
            }
        }

        // Update pagination buttons
        function updatePaginationButtons(totalPages) {
            paginationContainer.innerHTML = '';
            
            if (totalPages <= 1) {
                return;
            }
            
            // Tombol Previous
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.id = 'prev-page';
            prevBtn.innerHTML = '&laquo; Sebelumnya';
            prevBtn.disabled = currentPage <= 1;
            prevBtn.addEventListener('click', () => {
                loadCodeFeed('prev');
            });
            paginationContainer.appendChild(prevBtn);
            
            // Info halaman saat ini
            const pageInfo = document.createElement('span');
            pageInfo.className = 'page-info';
            pageInfo.textContent = ` Halaman ${currentPage} dari ${totalPages} `;
            paginationContainer.appendChild(pageInfo);
            
            // Tombol Next
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.id = 'next-page';
            nextBtn.innerHTML = 'Selanjutnya &raquo;';
            nextBtn.disabled = currentPage >= totalPages;
            nextBtn.addEventListener('click', () => {
                loadCodeFeed('next');
            });
            paginationContainer.appendChild(nextBtn);
        }

// View a specific code
async function viewCode(codeId) {
    currentViewingCodeId = codeId;
    
    try {
        // Get code data
        const codeDoc = await db.collection('codes').doc(codeId).get();
        
        if (!codeDoc.exists) {
            showNotification('Kode tidak ditemukan', 'error');
            showPage('home-page');
            return;
        }
        
        const code = codeDoc.data();
        
        // Update view count (only if user is authenticated)
        if (currentUser) {
            try {
                await db.collection('codes').doc(codeId).update({
                    views: firebase.firestore.FieldValue.increment(1)
                });
                
                // Update user's total views if profile exists
                try {
                    await db.collection('profiles').doc(code.author_id).update({
                        total_views: firebase.firestore.FieldValue.increment(1)
                    });
                } catch (error) {
                    console.error('Error updating profile views:', error);
                }
            } catch (error) {
                console.error('Error updating view count:', error);
            }
        }
        
        // Escape semua data sebelum ditampilkan
        const safeTitle = escapeHtml(code.title);
        const safeDescription = code.description ? escapeHtml(code.description) : '';
        const safeCode = escapeHtml(code.code);
        const safeDisplayName = escapeHtml(code.author_name);
        
        // Update view page
        document.getElementById('view-author-avatar').src = code.author_avatar || 'https://via.placeholder.com/40';
        document.getElementById('view-author-avatar').onerror = function() {
            this.src = 'https://via.placeholder.com/40';
        };
        
        const viewAuthorName = document.getElementById('view-author-name');
        viewAuthorName.textContent = safeDisplayName;
        viewAuthorName.dataset.userid = code.author_id;
        
        // Add click event to username for profile view
        viewAuthorName.onclick = null; // Reset previous event handler
        if (currentUser) {
            viewAuthorName.addEventListener('click', (e) => {
                const userId = e.target.dataset.userid;
                loadProfilePage(userId);
                showPage('profile-page');
            });
            viewAuthorName.style.cursor = 'pointer';
            viewAuthorName.classList.add('clickable-username');
        } else {
            viewAuthorName.style.cursor = 'default';
            viewAuthorName.classList.remove('clickable-username');
        }
        
        if (code.author_verified) {
            document.getElementById('view-verified-badge').style.display = 'inline';
        } else {
            document.getElementById('view-verified-badge').style.display = 'none';
        }
        
        if (code.author_admin) {
            document.getElementById('view-admin-badge').style.display = 'inline';
        } else {
            document.getElementById('view-admin-badge').style.display = 'none';
        }
        
        document.getElementById('view-code-language').textContent = code.language;
        document.getElementById('view-code-title').textContent = safeTitle;
        document.getElementById('view-code-description').textContent = safeDescription;
        document.getElementById('view-code-views').textContent = (code.views || 0) + (currentUser ? 1 : 0);
        document.getElementById('view-code-copies').textContent = code.copies || 0;
        document.getElementById('view-code-likes').textContent = code.likes || 0;
        
        const codeContent = document.getElementById('view-code-content');
        codeContent.textContent = safeCode;
        codeContent.className = `language-${code.language}`;
        
        // Check if current user can delete this code
        if (currentUser && (currentUser.uid === code.author_id || await checkAdminStatus(currentUser.uid))) {
            deleteCodeButton.style.display = 'block';
        } else {
            deleteCodeButton.style.display = 'none';
        }
        
        // Check if current user has liked this code
        if (currentUser && code.liked_by && code.liked_by.includes(currentUser.uid)) {
            likeCodeButton.innerHTML = '<i class="material-icons">favorite</i> Tidak Suka';
            likeCodeButton.classList.add('following');
        } else {
            likeCodeButton.innerHTML = '<i class="material-icons">favorite_border</i> Suka';
            likeCodeButton.classList.remove('following');
        }
        
        // Show/hide like button based on authentication
        if (currentUser) {
            likeCodeButton.style.display = 'block';
        } else {
            likeCodeButton.style.display = 'none';
        }
        
        // Apply syntax highlighting
        setTimeout(() => {
            hljs.highlightElement(codeContent);
        }, 0);
        
        showPage('view-code-page', codeId);
    } catch (error) {
        console.error('Error viewing code:', error);
        if (error.code === 'permission-denied') {
            showNotification('Anda tidak memiliki izin untuk melihat kode ini', 'error');
        } else {
            showNotification('Gagal memuat kode: ' + error.message, 'error');
        }
        showPage('home-page');
    }
}

        // Handle copying code
        async function handleCopyCode() {
            const codeContent = document.getElementById('view-code-content').textContent;
            
            try {
                await navigator.clipboard.writeText(codeContent);
                
                // Update copy count
                await db.collection('codes').doc(currentViewingCodeId).update({
                    copies: firebase.firestore.FieldValue.increment(1)
                });
                
                // Update user's total copies if profile exists
                try {
                    const codeDoc = await db.collection('codes').doc(currentViewingCodeId).get();
                    const code = codeDoc.data();
                    
                    await db.collection('profiles').doc(code.author_id).update({
                        total_copies: firebase.firestore.FieldValue.increment(1)
                    });
                } catch (error) {
                    console.error('Error updating profile copies:', error);
                }
                
                showNotification('Kode berhasil disalin!', 'success');
            } catch (error) {
                showNotification('Gagal menyalin kode', 'error');
            }
        }

        // Handle liking code
        async function handleLikeCode() {
            if (!currentUser) {
                showNotification('Silakan masuk untuk menyukai kode', 'info');
                showPage('auth-page');
                return;
            }
            
            try {
                const codeDoc = await db.collection('codes').doc(currentViewingCodeId).get();
                const code = codeDoc.data();
                
                let newLikes = code.likes || 0;
                let newLikedBy = code.liked_by || [];
                
                if (newLikedBy.includes(currentUser.uid)) {
                    // Unlike
                    newLikes--;
                    newLikedBy = newLikedBy.filter(uid => uid !== currentUser.uid);
                    likeCodeButton.innerHTML = '<i class="material-icons">favorite_border</i> Suka';
                    likeCodeButton.classList.remove('following');
                } else {
                    // Like
                    newLikes++;
                    newLikedBy.push(currentUser.uid);
                    likeCodeButton.innerHTML = '<i class="material-icons">favorite</i> Tidak Suka';
                    likeCodeButton.classList.add('following');
                }
                
                // Update like count
                await db.collection('codes').doc(currentViewingCodeId).update({
                    likes: newLikes,
                    liked_by: newLikedBy
                });
                
                // Update user's total likes if profile exists
                try {
                    await db.collection('profiles').doc(code.author_id).update({
                        total_likes: firebase.firestore.FieldValue.increment(1)
                    });
                } catch (error) {
                    console.error('Error updating profile likes:', error);
                }
                
                document.getElementById('view-code-likes').textContent = newLikes;
                
            } catch (error) {
                showNotification('Gagal menyukai kode', 'error');
            }
        }

        // Handle deleting code
        async function handleDeleteCode() {
            if (!currentUser) {
                showNotification('Silakan masuk untuk menghapus kode', 'info');
                return;
            }
            
            try {
                const codeDoc = await db.collection('codes').doc(currentViewingCodeId).get();
                const code = codeDoc.data();
                
                // Check if user has permission to delete
                if (currentUser.uid !== code.author_id && !await checkAdminStatus(currentUser.uid)) {
                    showNotification('Anda tidak memiliki izin untuk menghapus kode ini', 'error');
                    return;
                }
                
                if (!confirm('Apakah Anda yakin ingin menghapus kode ini?')) {
                    return;
                }
                
                // Delete code
                await db.collection('codes').doc(currentViewingCodeId).delete();
                
                // Update user's codes shared count
                await db.collection('profiles').doc(code.author_id).update({
                    codes_shared: firebase.firestore.FieldValue.increment(-1)
                });
                
                showNotification('Kode berhasil dihapus!', 'success');
                showPage('home-page');
                loadCodeFeed('first');
                
            } catch (error) {
                showNotification('Gagal menghapus kode', 'error');
            }
        }

     // Show share modal
function showShareModal() {
    const currentUrl = window.location.origin + window.location.pathname + `#code=${currentViewingCodeId}`;
    shareUrlInput.value = currentUrl;
    shareModal.style.display = 'flex';
}

// Share to specific platform
function shareToPlatform(platform) {
    const url = encodeURIComponent(shareUrlInput.value);
    const title = encodeURIComponent(document.getElementById('view-code-title').textContent);
    
    let shareUrl = '';
    
    switch(platform) {
        case 'facebook':
            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
            break;
        case 'twitter':
            shareUrl = `https://twitter.com/intent/tweet?text=${title}&url=${url}`;
            break;
        case 'whatsapp':
            shareUrl = `https://wa.me/?text=${title} ${url}`;
            break;
        case 'telegram':
            shareUrl = `https://t.me/share/url?url=${url}&text=${title}`;
            break;
        case 'linkedin':
            shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
            break;
        case 'copy':
            copyShareUrl();
            return;
        default:
            return;
    }
    
    window.open(shareUrl, '_blank');
}

        // Copy share URL to clipboard
        async function copyShareUrl() {
            try {
                await navigator.clipboard.writeText(shareUrlInput.value);
                showNotification('Link berhasil disalin!', 'success');
            } catch (error) {
                showNotification('Gagal menyalin link', 'error');
            }
        }

        // Load user profile
        async function loadProfilePage(userId) {
            currentViewingProfileId = userId;
            
            try {
                const profileDoc = await db.collection('profiles').doc(userId).get();
                
                if (!profileDoc.exists) {
                    showNotification('Profil tidak ditemukan', 'error');
                    return;
                }
                
                const userProfile = profileDoc.data();
                
                // Update profile page
                if (userProfile.banner_url) {
                    document.getElementById('profile-banner').style.backgroundImage = `url(${userProfile.banner_url})`;
                } else {
                    document.getElementById('profile-banner').style.backgroundImage = '';
                    document.getElementById('profile-banner').style.backgroundColor = 'var(--primary-color)';
                }
                
                document.getElementById('profile-avatar').src = userProfile.avatar_url || 'https://via.placeholder.com/100';
                document.getElementById('profile-display-name').textContent = userProfile.display_name;
                document.getElementById('profile-bio').textContent = userProfile.bio || 'Tidak ada bio';
                document.getElementById('profile-codes-count').textContent = userProfile.codes_shared || 0;
                document.getElementById('profile-views-count').textContent = userProfile.total_views || 0;
                document.getElementById('profile-copies-count').textContent = userProfile.total_copies || 0;
                document.getElementById('profile-likes-count').textContent = userProfile.total_likes || 0;
                document.getElementById('followers-count').textContent = userProfile.followers_count || 0;
                document.getElementById('following-count').textContent = userProfile.following_count || 0;
                
                if (userProfile.is_verified) {
                    document.getElementById('profile-verified-badge').style.display = 'inline';
                } else {
                    document.getElementById('profile-verified-badge').style.display = 'none';
                }
                
                if (userProfile.is_admin) {
                    document.getElementById('profile-admin-badge').style.display = 'inline';
                } else {
                    document.getElementById('profile-admin-badge').style.display = 'none';
                }
                
                // Update social links
                const socialLinksContainer = document.getElementById('social-links');
                socialLinksContainer.innerHTML = '';
                
                if (userProfile.social_links) {
                    if (userProfile.social_links.github) {
                        socialLinksContainer.innerHTML += `
                            <a href="${userProfile.social_links.github}" target="_blank" class="social-link">
                                <i class="fab fa-github"></i>
                            </a>
                        `;
                    }
                    if (userProfile.social_links.instagram) {
                        socialLinksContainer.innerHTML += `
                            <a href="${userProfile.social_links.instagram}" target="_blank" class="social-link">
                                <i class="fab fa-instagram"></i>
                            </a>
                        `;
                    }
                    if (userProfile.social_links.whatsapp) {
                        socialLinksContainer.innerHTML += `
                            <a href="${userProfile.social_links.whatsapp}" target="_blank" class="social-link">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                        `;
                    }
                    if (userProfile.social_links.website) {
                        socialLinksContainer.innerHTML += `
                            <a href="${userProfile.social_links.website}" target="_blank" class="social-link">
                                <i class="fas fa-globe"></i>
                            </a>
                        `;
                    }
                }
                
                // Show/hide follow button
                if (currentUser && currentUser.uid !== userId) {
                    followBtn.style.display = 'block';
                    // Check if current user is following this user
                    await checkFollowStatus(userId);
                } else {
                    followBtn.style.display = 'none';
                }
                
                // Load user's codes
                loadUserCodes(userId);
                
                // If it's the current user's profile, show edit button
                if (currentUser && currentUser.uid === userId) {
                    // Remove existing edit button if any
                    const existingEditBtn = document.getElementById('edit-profile-btn');
                    if (existingEditBtn) {
                        existingEditBtn.remove();
                    }
                    
                    const editButton = document.createElement('button');
                    editButton.className = 'btn-outline comic-button';
                    editButton.id = 'edit-profile-btn';
                    editButton.innerHTML = '<i class="material-icons">edit</i> Edit Profil';
                    editButton.addEventListener('click', () => {
                        loadEditProfilePage();
                        showPage('edit-profile-page');
                    });
                    
                    const profileInfo = document.querySelector('.profile-info');
                    profileInfo.appendChild(editButton);
                } else {
                    // Remove edit button if viewing someone else's profile
                    const existingEditBtn = document.getElementById('edit-profile-btn');
                    if (existingEditBtn) {
                        existingEditBtn.remove();
                    }
                }
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // Check follow status
        // Check follow status
// Check follow status
async function checkFollowStatus(userId) {
    try {
        // Tidak perlu mengecek jika user mencoba follow diri sendiri
        if (currentUser.uid === userId) {
            followBtn.style.display = 'none';
            return;
        }
        
        const followQuery = await db.collection('follows')
            .where('follower_id', '==', currentUser.uid)
            .where('following_id', '==', userId)
            .get();
        
        if (!followQuery.empty) {
            followBtn.textContent = 'Mengikuti';
            followBtn.classList.add('following');
        } else {
            followBtn.textContent = 'Ikuti';
            followBtn.classList.remove('following');
        }
        
        followBtn.style.display = 'block';
    } catch (error) {
        console.error('Error checking follow status:', error);
        
        // Default to "Ikuti" if there's an error
        followBtn.textContent = 'Ikuti';
        followBtn.classList.remove('following');
        followBtn.style.display = 'block';
    }
}

// Handle follow/unfollow
async function handleFollow() {
    if (!currentUser) {
        showNotification('Silakan masuk untuk mengikuti pengguna', 'info');
        showPage('auth-page');
        return;
    }
    
    // Tidak boleh follow diri sendiri
    if (currentUser.uid === currentViewingProfileId) {
        showNotification('Anda tidak dapat mengikuti diri sendiri', 'error');
        return;
    }
    
    try {
        // Query untuk mencari dokumen follow yang sudah ada
        const followQuery = await db.collection('follows')
            .where('follower_id', '==', currentUser.uid)
            .where('following_id', '==', currentViewingProfileId)
            .get();
        
        if (!followQuery.empty) {
            // Unfollow - hapus dokumen follow yang sudah ada
            const followDoc = followQuery.docs[0];
            await db.collection('follows').doc(followDoc.id).delete();
            
            // Update counts
            await db.collection('profiles').doc(currentUser.uid).update({
                following_count: firebase.firestore.FieldValue.increment(-1)
            });
            
            await db.collection('profiles').doc(currentViewingProfileId).update({
                followers_count: firebase.firestore.FieldValue.increment(-1)
            });
            
            followBtn.textContent = 'Ikuti';
            followBtn.classList.remove('following');
            
            showNotification('Berhasil berhenti mengikuti', 'success');
        } else {
            // Follow - buat dokumen follow baru
            await db.collection('follows').add({
                follower_id: currentUser.uid,
                following_id: currentViewingProfileId,
                created_at: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // Update counts
            await db.collection('profiles').doc(currentUser.uid).update({
                following_count: firebase.firestore.FieldValue.increment(1)
            });
            
            await db.collection('profiles').doc(currentViewingProfileId).update({
                followers_count: firebase.firestore.FieldValue.increment(1)
            });
            
            followBtn.textContent = 'Mengikuti';
            followBtn.classList.add('following');
            
            showNotification('Berhasil mengikuti', 'success');
        }
        
        // Update counts display
        const profileDoc = await db.collection('profiles').doc(currentViewingProfileId).get();
        const profile = profileDoc.data();
        document.getElementById('followers-count').textContent = profile.followers_count || 0;
        
        const currentUserProfileDoc = await db.collection('profiles').doc(currentUser.uid).get();
        const currentUserProfile = currentUserProfileDoc.data();
        document.getElementById('following-count').textContent = currentUserProfile.following_count || 0;
        
    } catch (error) {
        console.error('Error in follow/unfollow:', error);
        
        if (error.code === 'permission-denied') {
            // Debug: Tampilkan informasi lebih detail tentang error
            console.log('Current User UID:', currentUser.uid);
            console.log('Viewing Profile ID:', currentViewingProfileId);
            
            showNotification('Error izin: Pastikan Anda tidak mencoba mengikuti diri sendiri', 'error');
        } else if (error.code === 'failed-precondition' && error.message.includes('index')) {
            showNotification('Sistem sedang dipersiapkan. Silakan coba lagi dalam beberapa saat.', 'error');
        } else {
            showNotification('Gagal mengikuti pengguna: ' + error.message, 'error');
        }
    }
}

        // Load follow list
        async function loadFollowList(type) {
            try {
                let query;
                
                if (type === 'followers') {
                    query = db.collection('follows')
                        .where('following_id', '==', currentViewingProfileId);
                    followPageTitle.textContent = 'Pengikut';
                } else {
                    query = db.collection('follows')
                        .where('follower_id', '==', currentViewingProfileId);
                    followPageTitle.textContent = 'Mengikuti';
                }
                
                const followsSnapshot = await query.get();
                
                followList.innerHTML = '';
                
                if (followsSnapshot.empty) {
                    followList.innerHTML = `<p class="text-center">Tidak ada ${type === 'followers' ? 'pengikut' : 'yang diikuti'}</p>`;
                    return;
                }
                
                const userIds = followsSnapshot.docs.map(doc => 
                    type === 'followers' ? doc.data().follower_id : doc.data().following_id
                );
                
                // Get user profiles
                const usersPromises = userIds.map(userId => 
                    db.collection('profiles').doc(userId).get()
                );
                
                const usersSnapshots = await Promise.all(usersPromises);
                
                usersSnapshots.forEach(userDoc => {
                    if (!userDoc.exists) return;
                    
                    const user = userDoc.data();
                    
                    const userItem = document.createElement('div');
                    userItem.className = 'leaderboard-item';
                    
                    userItem.innerHTML = `
                        <div class="leaderboard-user">
                            <img src="${user.avatar_url || 'https://via.placeholder.com/40'}" alt="User Avatar" class="leaderboard-avatar" onerror="this.src='https://via.placeholder.com/40'">
                            <div>
                                <div class="username">
                                    <span class="clickable-username" data-userid="${user.user_id}">${escapeHtml(user.display_name)}</span>
                                    ${user.is_verified ? '<span class="verified-badge"><i class="fas fa-check-circle"></i></span>' : ''}
                                    ${user.is_admin ? '<span class="admin-badge"><i class="fas fa-crown</i></span>' : ''}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Add click event to username for profile view
                    const usernameElement = userItem.querySelector('.clickable-username');
                    usernameElement.addEventListener('click', (e) => {
                        const userId = e.target.dataset.userid;
                        loadProfilePage(userId);
                        showPage('profile-page');
                    });
                    
                    followList.appendChild(userItem);
                });
                
                showPage('follow-page');
                
            } catch (error) {
                console.error('Error loading follow list:', error);
                showNotification('Gagal memuat daftar', 'error');
            }
        }

        // Load user's codes
        // Load user's codes
async function loadUserCodes(userId) {
    const userCodesList = document.getElementById('user-codes-list');
    userCodesList.innerHTML = '<div class="spinner"></div>';
    
    try {
        const codesSnapshot = await db.collection('codes')
            .where('author_id', '==', userId)
            .orderBy('created_at', 'desc')
            .get();
        
        userCodesList.innerHTML = '';
        
        if (codesSnapshot.empty) {
            userCodesList.innerHTML = '<p class="text-center">Belum ada kode yang dibagikan</p>';
            return;
        }
        
        codesSnapshot.forEach(doc => {
            const code = doc.data();
            const codeId = doc.id;
            
            // Escape semua data yang akan ditampilkan
            const safeTitle = escapeHtml(code.title);
            const safeDescription = code.description ? escapeHtml(code.description) : '';
            const safeCode = escapeHtml(code.code);
            
            const codeCard = document.createElement('div');
            codeCard.className = 'card code-card';
            codeCard.dataset.id = codeId;
            
            codeCard.innerHTML = `
                <h3>${safeTitle}</h3>
                ${safeDescription ? `<p>${safeDescription}</p>` : ''}
                
                <div class="code-preview">
                    <pre><code class="language-${code.language}">${safeCode}</code></pre>
                </div>
                
                <div class="code-stats">
                    <div class="code-stat">
                        <i class="material-icons">visibility</i>
                        <span>${code.views || 0}</span>
                    </div>
                    <div class="code-stat">
                        <i class="material-icons">content_copy</i>
                        <span>${code.copies || 0}</span>
                    </div>
                    <div class="code-stat">
                        <i class="material-icons">favorite</i>
                        <span>${code.likes || 0}</span>
                    </div>
                </div>
            `;
            
            // Apply syntax highlighting
            setTimeout(() => {
                const codeElement = codeCard.querySelector('code');
                if (codeElement) {
                    hljs.highlightElement(codeElement);
                }
            }, 0);
            
            codeCard.addEventListener('click', () => {
                viewCode(codeId);
            });
            
            userCodesList.appendChild(codeCard);
        });
    } catch (error) {
        console.error('Error loading user codes:', error);
        userCodesList.innerHTML = '<p class="text-center">Gagal memuat kode. Silakan coba lagi nanti.</p>';
        
        // Jika error karena index, beri petunjuk untuk membuat index
        if (error.message.includes('index')) {
            showNotification('Sedang memuat data. Ini mungkin memakan waktu beberapa saat pertama kali.', 'info');
            
            // Coba lagi dengan query yang lebih sederhana (tanpa orderBy)
            try {
                const simpleQuerySnapshot = await db.collection('codes')
                    .where('author_id', '==', userId)
                    .get();
                
                userCodesList.innerHTML = '';
                
                if (simpleQuerySnapshot.empty) {
                    userCodesList.innerHTML = '<p class="text-center">Belum ada kode yang dibagikan</p>';
                    return;
                }
                
                simpleQuerySnapshot.forEach(doc => {
                    const code = doc.data();
                    const codeId = doc.id;
                    
                    // Escape semua data yang akan ditampilkan
                    const safeTitle = escapeHtml(code.title);
                    const safeDescription = code.description ? escapeHtml(code.description) : '';
                    const safeCode = escapeHtml(code.code);
                    
                    const codeCard = document.createElement('div');
                    codeCard.className = 'card code-card';
                    codeCard.dataset.id = codeId;
                    
                    codeCard.innerHTML = `
                        <h3>${safeTitle}</h3>
                        ${safeDescription ? `<p>${safeDescription}</p>` : ''}
                        
                        <div class="code-preview">
                            <pre><code class="language-${code.language}">${safeCode}</code></pre>
                        </div>
                        
                        <div class="code-stats">
                            <div class="code-stat">
                                <i class="material-icons">visibility</i>
                                <span>${code.views || 0}</span>
                            </div>
                            <div class="code-stat">
                                <i class="material-icons">content_copy</i>
                                <span>${code.copies || 0}</span>
                            </div>
                            <div class="code-stat">
                                <i class="material-icons">favorite</i>
                                <span>${code.likes || 0}</span>
                            </div>
                        </div>
                    `;
                    
                    // Apply syntax highlighting
                    setTimeout(() => {
                        const codeElement = codeCard.querySelector('code');
                        if (codeElement) {
                            hljs.highlightElement(codeElement);
                        }
                    }, 0);
                    
                    codeCard.addEventListener('click', () => {
                        viewCode(codeId);
                    });
                    
                    userCodesList.appendChild(codeCard);
                });
            } catch (simpleError) {
                console.error('Error loading user codes with simple query:', simpleError);
                userCodesList.innerHTML = '<p class="text-center">Gagal memuat kode pengguna</p>';
            }
        }
    }
}

        // Load edit profile page
        async function loadEditProfilePage() {
            try {
                const profileDoc = await db.collection('profiles').doc(currentUser.uid).get();
                
                if (!profileDoc.exists) {
                    return;
                }
                
                const userProfile = profileDoc.data();
                
                // Pre-fill form fields
                document.getElementById('edit-display-name').value = userProfile.display_name || '';
                document.getElementById('edit-bio').value = userProfile.bio || '';
                
                // Pre-fill social links
                if (userProfile.social_links) {
                    document.getElementById('edit-github').value = userProfile.social_links.github || '';
                    document.getElementById('edit-instagram').value = userProfile.social_links.instagram || '';
                    document.getElementById('edit-whatsapp').value = userProfile.social_links.whatsapp || '';
                    document.getElementById('edit-website').value = userProfile.social_links.website || '';
                }
                
                avatarPreview.src = userProfile.avatar_url || 'https://via.placeholder.com/100';
                bannerPreview.src = userProfile.banner_url || 'https://via.placeholder.com/800x200';
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // Handle image upload to GitHub
        async function handleImageUpload(file, type) {
            if (!file) return;
            
            // Validasi tipe file
             if (!file.type.match('image.*')) {
            showNotification('Hanya file gambar yang diizinkan', 'error');
            return;
        }
        
                    // Validasi ukuran file (maksimal 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Ukuran file maksimal 5MB', 'error');
                return;
            }
            
            const progressBar = type === 'avatar' ? avatarProgressBar : bannerProgressBar;
            const progressContainer = type === 'avatar' ? avatarProgress : bannerProgress;
            const preview = type === 'avatar' ? avatarPreview : bannerPreview;
            
            // Tampilkan progress bar
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            
            try {
                // Prepare the file content and path
                const fileName = generateFileName(file);
                const path = `${folderPath}/${fileName}`;
                
                // Read file as base64
                const base64Content = await readFileAsBase64(file);
                
                // Upload to GitHub
                const githubUrl = await uploadToGitHub(repo, branch, path, base64Content);
                
                // Update preview
                preview.src = githubUrl;
                
                // Sembunyikan progress bar
                progressContainer.style.display = 'none';
                
                showNotification('Gambar berhasil diunggah', 'success');
                
                // Simpan URL gambar ke state sementara untuk disimpan nanti
                preview.dataset.uploadedUrl = githubUrl;
                
            } catch (error) {
                progressContainer.style.display = 'none';
                showNotification('Gagal mengunggah gambar: ' + error.message, 'error');
            }
        }

        // Generate a unique file name
        function generateFileName(file) {
            const extension = file.name.split('.').pop();
            const timestamp = new Date().getTime();
            const randomString = Math.random().toString(36).substring(2, 8);
            return `image-${timestamp}-${randomString}.${extension}`;
        }
        
        // Read file as base64
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }
        
        // Upload to GitHub
        async function uploadToGitHub(repo, branch, path, content) {
            const apiUrl = `https://api.github.com/repos/${githubUsername}/${repo}/contents/${path}`;
            
            const response = await fetch(apiUrl, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${githubToken}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: `Upload image: ${path}`,
                    content: content,
                    branch: branch
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Gagal mengupload ke GitHub');
            }
            
            // Return the raw content URL
            return `https://raw.githubusercontent.com/${githubUsername}/${repo}/${branch}/${path}`;
        }

        // Handle saving profile
        async function handleSaveProfile() {
            const displayName = document.getElementById('edit-display-name').value;
            const bio = document.getElementById('edit-bio').value;
            const github = document.getElementById('edit-github').value;
            const instagram = document.getElementById('edit-instagram').value;
            const whatsapp = document.getElementById('edit-whatsapp').value;
            const website = document.getElementById('edit-website').value;
            
            // Validasi input
            if (!displayName.trim()) {
                showNotification('Nama tampilan tidak boleh kosong', 'error');
                return;
            }
            
            try {
                const updates = {
                    display_name: displayName.trim(),
                    bio: bio.trim(),
                    social_links: {
                        github: github.trim(),
                        instagram: instagram.trim(),
                        whatsapp: whatsapp.trim(),
                        website: website.trim()
                    },
                    updated_at: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Jika ada avatar yang diunggah, tambahkan ke updates
                if (avatarPreview.dataset.uploadedUrl) {
                    updates.avatar_url = avatarPreview.dataset.uploadedUrl;
                }
                
                // Jika ada banner yang diunggah, tambahkan ke updates
                if (bannerPreview.dataset.uploadedUrl) {
                    updates.banner_url = bannerPreview.dataset.uploadedUrl;
                }
                
                showNotification('Menyimpan profil...', 'info');
                
                await db.collection('profiles').doc(currentUser.uid).update(updates);
                
                showNotification('Profil berhasil diperbarui!', 'success');
                
                // Tunggu sebentar sebelum redirect
                setTimeout(() => {
                    loadProfilePage(currentUser.uid);
                    showPage('profile-page');
                }, 1000);
            } catch (error) {
                console.error('Error saving profile:', error);
                showNotification('Gagal menyimpan profil: ' + error.message, 'error');
            }
        }

        // Handle search
        async function handleSearch() {
            const query = searchInput.value.trim().toLowerCase();
            if (!query) return;
            
            searchResults.innerHTML = '<div class="spinner"></div>';
            
            try {
                const codesSnapshot = await db.collection('codes')
                    .orderBy('created_at', 'desc')
                    .get();
                
                searchResults.innerHTML = '';
                
                if (codesSnapshot.empty) {
                    searchResults.innerHTML = '<p class="text-center">Tidak ada hasil ditemukan</p>';
                    return;
                }
                
                let foundResults = false;
                
                codesSnapshot.forEach(doc => {
                    const code = doc.data();
                    const codeId = doc.id;
                    
                    // Check if code matches search query
                    if (
                        code.title.toLowerCase().includes(query) ||
                        code.language.toLowerCase().includes(query) ||
                        (code.description && code.description.toLowerCase().includes(query))
                    ) {
                        foundResults = true;
                        
                        // Escape semua data yang akan ditampilkan
                        const safeTitle = escapeHtml(code.title);
                        const safeDescription = code.description ? escapeHtml(code.description) : '';
                        const safeCode = escapeHtml(code.code);
                        const safeDisplayName = escapeHtml(code.author_name);
                        
                        const codeCard = document.createElement('div');
                        codeCard.className = 'card code-card';
                        codeCard.dataset.id = codeId;
                        
                        codeCard.innerHTML = `
                            <div class="code-card-header">
                                <img src="${code.author_avatar || 'https://via.placeholder.com/40'}" alt="User Avatar" class="user-avatar" onerror="this.src='https://via.placeholder.com/40'">
                                <div class="user-info">
                                    <div class="username">
                                        <span class="clickable-username" data-userid="${code.author_id}">${safeDisplayName}</span>
                                        ${code.author_verified ? '<span class="verified-badge"><i class="fas fa-check-circle"></i></span>' : ''}
                                        ${code.author_admin ? '<span class="admin-badge"><i class="fas fa-crown"></i></span>' : ''}
                                    </div>
                                    <span class="code-language">${escapeHtml(code.language)}</span>
                                </div>
                            </div>
                            
                            <h3>${safeTitle}</h3>
                            ${safeDescription ? `<p>${safeDescription}</p>` : ''}
                            
                            <div class="code-preview">
                                <pre><code class="language-${code.language}">${safeCode}</code></pre>
                            </div>
                            
                            <div class="code-stats">
                                <div class="code-stat">
                                    <i class="material-icons">visibility</i>
                                    <span>${code.views || 0}</span>
                                </div>
                                <div class="code-stat">
                                    <i class="material-icons">content_copy</i>
                                    <span>${code.copies || 0}</span>
                                </div>
                                <div class="code-stat">
                                    <i class="material-icons">favorite</i>
                                    <span>${code.likes || 0}</span>
                                </div>
                            </div>
                        `;
                        
                        // Apply syntax highlighting
                        setTimeout(() => {
                            const codeElement = codeCard.querySelector('code');
                            if (codeElement) {
                                hljs.highlightElement(codeElement);
                            }
                        }, 0);
                        
                        // Add click event to view code
                        codeCard.addEventListener('click', (e) => {
                            // Jika yang diklik adalah username, jangan trigger view code
                            if (!e.target.classList.contains('clickable-username')) {
                                viewCode(codeId);
                            }
                        });
                        
                        // Add click event to username for profile view
                        const usernameElement = codeCard.querySelector('.clickable-username');
                        usernameElement.addEventListener('click', (e) => {
                            e.stopPropagation(); // Mencegah event bubbling ke parent
                            const userId = e.target.dataset.userid;
                            loadProfilePage(userId);
                            showPage('profile-page');
                        });
                        
                        searchResults.appendChild(codeCard);
                    }
                });
                
                if (!foundResults) {
                    searchResults.innerHTML = '<p class="text-center">Tidak ada hasil ditemukan</p>';
                }
            } catch (error) {
                searchResults.innerHTML = '<p class="text-center">Gagal melakukan pencarian</p>';
                showNotification(error.message, 'error');
            }
        }

        // Load admin stats
        async function loadAdminStats() {
            try {
                // Get total users
                const usersSnapshot = await db.collection('profiles').get();
                adminStats.totalUsers = usersSnapshot.size;
                
                // Get total codes
                const codesSnapshot = await db.collection('codes').get();
                adminStats.totalCodes = codesSnapshot.size;
                
                // Get today's codes
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                let todayCodes = 0;
                codesSnapshot.forEach(doc => {
                    const code = doc.data();
                    const codeDate = code.created_at ? code.created_at.toDate() : new Date();
                    if (codeDate >= today) {
                        todayCodes++;
                    }
                });
                adminStats.todayCodes = todayCodes;
                
                // Get total views
                let totalViews = 0;
                codesSnapshot.forEach(doc => {
                    const code = doc.data();
                    totalViews += code.views || 0;
                });
                adminStats.totalViews = totalViews;
                
                // Update UI
                document.getElementById('admin-total-users').textContent = adminStats.totalUsers;
                document.getElementById('admin-total-codes').textContent = adminStats.totalCodes;
                document.getElementById('admin-today-codes').textContent = adminStats.todayCodes;
                document.getElementById('admin-total-views').textContent = adminStats.totalViews;
                
            } catch (error) {
                console.error('Error loading admin stats:', error);
                showNotification('Gagal memuat statistik admin', 'error');
            }
        }

        // Handle user search (admin)
        async function handleUserSearch() {
            const query = userSearch.value.trim().toLowerCase();
            if (!query) return;
            
            userSearchResults.innerHTML = '<div class="spinner"></div>';
            
            try {
                const usersSnapshot = await db.collection('profiles').get();
                
                userSearchResults.innerHTML = '';
                
                if (usersSnapshot.empty) {
                    userSearchResults.innerHTML = '<p class="text-center">Tidak ada pengguna ditemukan</p>';
                    return;
                }
                
                let foundResults = false;
                
                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    const userId = doc.id;
                    
                    // Check if user matches search query
                    if (
                        user.display_name.toLowerCase().includes(query) ||
                        user.email.toLowerCase().includes(query)
                    ) {
                        foundResults = true;
                        
                        const userCard = document.createElement('div');
                        userCard.className = 'card';
                        userCard.innerHTML = `
                            <div class="code-card-header">
                                <img src="${user.avatar_url || 'https://via.placeholder.com/40'}" alt="User Avatar" class="user-avatar" onerror="this.src='https://via.placeholder.com/40'">
                                <div class="user-info">
                                    <div class="username">
                                        <span class="clickable-username" data-userid="${user.user_id}">${escapeHtml(user.display_name)}</span>
                                        ${user.is_verified ? '<span class="verified-badge"><i class="fas fa-check-circle"></i></span>' : ''}
                                        ${user.is_admin ? '<span class="admin-badge"><i class="fas fa-crown"></i></span>' : ''}
                                    </div>
                                    <div>Email: ${user.email}</div>
                                </div>
                            </div>
                            
                            <div class="profile-stats">
                                <div class="profile-stat">
                                    <div class="stat-value">${user.codes_shared || 0}</div>
                                    <div class="stat-label">Kode Dibagikan</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="stat-value">${user.total_views || 0}</div>
                                    <div class="stat-label">Total Dilihat</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="stat-value">${user.total_copies || 0}</div>
                                    <div class="stat-label">Total Disalin</div>
                                </div>
                            </div>
                            
                            ${!user.is_verified ? `
                                <button class="btn-primary comic-button verify-user-btn" data-userid="${userId}">
                                    Beri Centang Biru
                                </button>
                            ` : ''}
                            
                            ${user.is_verified ? `
                                <button class="btn-danger comic-button unverify-user-btn" data-userid="${userId}">
                                    Hapus Centang Biru
                                </button>
                            ` : ''}
                        `;
                        
                        // Add click event to username for profile view
                        const usernameElement = userCard.querySelector('.clickable-username');
                        usernameElement.addEventListener('click', (e) => {
                            const userId = e.target.dataset.userid;
                            loadProfilePage(userId);
                            showPage('profile-page');
                        });
                        
                        userSearchResults.appendChild(userCard);
                    }
                });
                
                if (!foundResults) {
                    userSearchResults.innerHTML = '<p class="text-center">Tidak ada pengguna ditemukan</p>';
                } else {
                    // Add event listeners to verify buttons
                    document.querySelectorAll('.verify-user-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const userId = e.target.dataset.userid;
                            verifyUser(userId, true);
                        });
                    });
                    
                    // Add event listeners to unverify buttons
                    document.querySelectorAll('.unverify-user-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const userId = e.target.dataset.userid;
                            verifyUser(userId, false);
                        });
                    });
                }
            } catch (error) {
                userSearchResults.innerHTML = '<p class="text-center">Gagal melakukan pencarian</p>';
                showNotification(error.message, 'error');
            }
        }

        // Verify user (admin only)
        async function verifyUser(userId, verify) {
            try {
                await db.collection('profiles').doc(userId).update({
                    is_verified: verify
                });
                
                // Also update all user's codes
                const userCodesSnapshot = await db.collection('codes')
                    .where('author_id', '==', userId)
                    .get();
                
                const batch = db.batch();
                
                userCodesSnapshot.forEach(doc => {
                    const codeRef = db.collection('codes').doc(doc.id);
                    batch.update(codeRef, { author_verified: verify });
                });
                
                await batch.commit();
                
                showNotification(`Pengguna berhasil ${verify ? 'diverifikasi' : 'dibatalkan verifikasinya'}`, 'success');
                handleUserSearch(); // Refresh search results
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // Load leaderboard
        async function loadLeaderboard() {
            const leaderboardList = document.getElementById('leaderboard-list');
            leaderboardList.innerHTML = '<div class="spinner"></div>';
            
            try {
                const usersSnapshot = await db.collection('profiles')
                    .orderBy('codes_shared', 'desc')
                    .limit(10)
                    .get();
                
                leaderboardList.innerHTML = '';
                
                if (usersSnapshot.empty) {
                    leaderboardList.innerHTML = '<p class="text-center">Belum ada data leaderboard</p>';
                    return;
                }
                
                let rank = 1;
                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    
                    const leaderboardItem = document.createElement('div');
                    leaderboardItem.className = 'leaderboard-item';
                    
                    leaderboardItem.innerHTML = `
                        <div class="leaderboard-rank">${rank}</div>
                        <div class="leaderboard-user">
                            <img src="${user.avatar_url || 'https://via.placeholder.com/40'}" alt="User Avatar" class="leaderboard-avatar" onerror="this.src='https://via.placeholder.com/40'">
                            <div>
                                <div class="username">
                                    <span class="clickable-username" data-userid="${user.user_id}">${escapeHtml(user.display_name)}</span>
                                    ${user.is_verified ? '<span class="verified-badge"><i class="fas fa-check-circle"></i></span>' : ''}
                                    ${user.is_admin ? '<span class="admin-badge"><i class="fas fa-crown"></i></span>' : ''}
                                </div>
                            </div>
                        </div>
                        <div class="leaderboard-value">${user.codes_shared || 0} kode</div>
                    `;
                    
                    // Add click event to username for profile view
                    const usernameElement = leaderboardItem.querySelector('.clickable-username');
                    usernameElement.addEventListener('click', (e) => {
                        const userId = e.target.dataset.userid;
                        loadProfilePage(userId);
                        showPage('profile-page');
                    });
                    
                    leaderboardList.appendChild(leaderboardItem);
                    rank++;
                });
            } catch (error) {
                leaderboardList.innerHTML = '<p class="text-center">Gagal memuat leaderboard</p>';
                showNotification(error.message, 'error');
            }
        }

        // Check if user is admin
        async function checkAdminStatus(userId) {
            try {
                const profileDoc = await db.collection('profiles').doc(userId).get();
                
                if (profileDoc.exists && profileDoc.data().is_admin) {
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error checking admin status:', error);
                return false;
            }
        }

        // Escape HTML to prevent XSS
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
            
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'info';
            if (type === 'success') icon = 'check_circle';
            if (type === 'error') icon = 'error';
            if (type === 'warning') icon = 'warning';
            
            notification.innerHTML = `
                <i class="material-icons">${icon}</i>
                <span>${message}</span>
            `;
            
            document.getElementById('notification-container').appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
